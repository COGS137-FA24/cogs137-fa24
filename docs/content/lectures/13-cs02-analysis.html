<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Professor Shannon Ellis">
<meta name="dcterms.date" content="2024-11-19">

<title>COGS 137 - 13-cs02-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/lectures/14-cs02-inclass.html" rel="next">
<link href="../../content/lectures/12-regression.html" rel="prev">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="COGS 137 - 13-cs02-analysis">
<meta property="og:image" content="https://cogs137-fa24.github.io/cogs137-fa24/content/lectures/images/background.png">
<meta property="og:site_name" content="COGS 137">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/lectures/00-welcome.html">Notes</a></li><li class="breadcrumb-item"><a href="../../content/lectures/13-cs02-analysis.html">13-cs02-analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/cogs137-logo-hex.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <div class="dropdown">
      <a href="" title="Canvas" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Canvas"><i class="bi bi-person-fill"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://canvas.ucsd.edu/courses/58555">
            Homepage
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://canvas.ucsd.edu/courses/58555/gradebook">
            Grades
            </a>
          </li>
      </ul>
    </div>
    <a href="https://datahub.ucsd.edu/hub/spawn" title="Datahub" class="quarto-navigation-tool px-1" aria-label="Datahub"><i class="bi bi-cloud"></i></a>
    <a href="https://piazza.com/class/m1jv2820hu54m" title="Piazza" class="quarto-navigation-tool px-1" aria-label="Piazza"><i class="bi bi-question"></i></a>
    <a href="https://chatgpt.com/" title="ChatGPT" class="quarto-navigation-tool px-1" aria-label="ChatGPT"><i class="bi bi-robot"></i></a>
    <a href="https://github.com/COGS137-FA24" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Schedule &amp; Policies</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../policies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Policies</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/00-welcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">00-welcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/01-intro-to-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01-intro-to-r</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/02-cs01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02-cs01-intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/03-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03-dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/04-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04-ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/05-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05-viz</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/06-cs01-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06-cs01-eda</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/07-written-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07-written-communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/08-cs01-inclass.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08-cs01-inclass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/09-cs02-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09-cs02-intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/10-cs02-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10-cs02-eda</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/11-tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11-tidymodels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/12-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12-regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/13-cs02-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">13-cs02-analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/14-cs02-inclass.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14-cs02-inclass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/15-oral-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15-oral-communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/16-project-inclass.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">16-project-inclass</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/lectures/17-presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">17-presentations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/01-lab-intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab01: Tooling and R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/02-lab-cs01-wrangle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab02: CS01 Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/03-lab-cs01-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab03: CS01 Data Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/04-lab-cs01-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab04: CS01 EDA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/05-lab-cs01-communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab05: CS01 Communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/06-lab-cs02-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab06: CS02 EDA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/labs/07-lab-mlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab07: MLR</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Case Studies</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/cs/cs-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CS: Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/cs/cs01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CS01: Biomarkers of Recent Use</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/cs/cs02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CS02: Predicting Annual Air Pollution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/cs/final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Homework</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/hw/hw-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/hw/hw-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/hw/hw-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW03</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Computing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../computing/computing-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../computing/computing-troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../computing/computing-cheatsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cheatsheets</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cs02-predicting-air-pollution-analysis" id="toc-cs02-predicting-air-pollution-analysis" class="nav-link active" data-scroll-target="#cs02-predicting-air-pollution-analysis">CS02: Predicting Air Pollution (Analysis)</a>
  <ul class="collapse">
  <li><a href="#qa" id="toc-qa" class="nav-link" data-scroll-target="#qa">Q&amp;A</a></li>
  <li><a href="#course-announcements" id="toc-course-announcements" class="nav-link" data-scroll-target="#course-announcements">Course Announcements</a></li>
  <li><a href="#progress-check-in" id="toc-progress-check-in" class="nav-link" data-scroll-target="#progress-check-in">Progress Check-in</a></li>
  </ul></li>
  <li><a href="#question" id="toc-question" class="nav-link" data-scroll-target="#question">Question</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#building-our-tidymodels-knowledge" id="toc-building-our-tidymodels-knowledge" class="nav-link" data-scroll-target="#building-our-tidymodels-knowledge">Building our <code>tidymodels</code> knowledge:</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a></li>
  <li><a href="#data-splitting" id="toc-data-splitting" class="nav-link" data-scroll-target="#data-splitting">Data Splitting</a></li>
  <li><a href="#split-the-data" id="toc-split-the-data" class="nav-link" data-scroll-target="#split-the-data">Split the Data</a></li>
  <li><a href="#pre-processing-recipe-bake" id="toc-pre-processing-recipe-bake" class="nav-link" data-scroll-target="#pre-processing-recipe-bake">Pre-processing: <code>recipe()</code> + <code>bake()</code></a></li>
  <li><a href="#step-1-specify-variable-roles" id="toc-step-1-specify-variable-roles" class="nav-link" data-scroll-target="#step-1-specify-variable-roles">Step 1: Specify variable roles</a></li>
  <li><a href="#step-2-pre-process-with-step" id="toc-step-2-pre-process-with-step" class="nav-link" data-scroll-target="#step-2-pre-process-with-step">Step 2: Pre-process with <code>step*()</code></a></li>
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps">Steps</a></li>
  <li><a href="#selecting-variables" id="toc-selecting-variables" class="nav-link" data-scroll-target="#selecting-variables">Selecting Variables</a></li>
  <li><a href="#one-hot-encoding" id="toc-one-hot-encoding" class="nav-link" data-scroll-target="#one-hot-encoding">One-hot Encoding</a></li>
  <li><a href="#putting-our-recipe-together" id="toc-putting-our-recipe-together" class="nav-link" data-scroll-target="#putting-our-recipe-together">Putting our <code>recipe</code> together</a></li>
  <li><a href="#step-3-running-the-pre-processing-prep" id="toc-step-3-running-the-pre-processing-prep" class="nav-link" data-scroll-target="#step-3-running-the-pre-processing-prep">Step 3: Running the pre-processing (<code>prep</code>)</a></li>
  <li><a href="#step-4-extract-pre-processed-training-data-using-bake" id="toc-step-4-extract-pre-processed-training-data-using-bake" class="nav-link" data-scroll-target="#step-4-extract-pre-processed-training-data-using-bake">Step 4: Extract pre-processed training data using <code>bake()</code></a></li>
  <li><a href="#step-5-extract-pre-processed-testing-data-using-bake" id="toc-step-5-extract-pre-processed-testing-data-using-bake" class="nav-link" data-scroll-target="#step-5-extract-pre-processed-testing-data-using-bake">Step 5: Extract pre-processed testing data using <code>bake()</code></a></li>
  <li><a href="#aside-return-to-wrangling" id="toc-aside-return-to-wrangling" class="nav-link" data-scroll-target="#aside-return-to-wrangling">Aside: return to wrangling</a></li>
  <li><a href="#specifying-our-model-parsnip" id="toc-specifying-our-model-parsnip" class="nav-link" data-scroll-target="#specifying-our-model-parsnip">Specifying our model (<code>parsnip</code>)</a></li>
  <li><a href="#step-1-specify-the-model" id="toc-step-1-specify-the-model" class="nav-link" data-scroll-target="#step-1-specify-the-model">Step 1: Specify the model</a></li>
  <li><a href="#step-2-fit-the-model" id="toc-step-2-fit-the-model" class="nav-link" data-scroll-target="#step-2-fit-the-model">Step 2: Fit the model</a></li>
  <li><a href="#step-3-prepare-the-recipe-estimate-the-parameters" id="toc-step-3-prepare-the-recipe-estimate-the-parameters" class="nav-link" data-scroll-target="#step-3-prepare-the-recipe-estimate-the-parameters">Step 3: Prepare the recipe (estimate the parameters)</a></li>
  <li><a href="#step-4-assess-model-fit" id="toc-step-4-assess-model-fit" class="nav-link" data-scroll-target="#step-4-assess-model-fit">Step 4: Assess model fit</a></li>
  <li><a href="#visualizing-model-performance" id="toc-visualizing-model-performance" class="nav-link" data-scroll-target="#visualizing-model-performance">Visualizing Model Performance</a></li>
  <li><a href="#quantifying-model-performance" id="toc-quantifying-model-performance" class="nav-link" data-scroll-target="#quantifying-model-performance">Quantifying Model Performance</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-Validation</a></li>
  <li><a href="#implementing-in-rsample" id="toc-implementing-in-rsample" class="nav-link" data-scroll-target="#implementing-in-rsample">Implementing in <code>rsample()</code></a></li>
  <li><a href="#model-assessment-on-v-folds" id="toc-model-assessment-on-v-folds" class="nav-link" data-scroll-target="#model-assessment-on-v-folds">Model Assessment on v-folds</a></li>
  </ul></li>
  <li><a href="#a-different-model" id="toc-a-different-model" class="nav-link" data-scroll-target="#a-different-model">A different model?</a>
  <ul class="collapse">
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest">Random Forest</a></li>
  <li><a href="#but-not-just-one-tree" id="toc-but-not-just-one-tree" class="nav-link" data-scroll-target="#but-not-just-one-tree">But not just one tree…</a></li>
  <li><a href="#visualizing-a-rf" id="toc-visualizing-a-rf" class="nav-link" data-scroll-target="#visualizing-a-rf">Visualizing a RF</a></li>
  <li><a href="#updating-our-recipe" id="toc-updating-our-recipe" class="nav-link" data-scroll-target="#updating-our-recipe">Updating our <code>recipe()</code></a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a></li>
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow">Workflow</a></li>
  <li><a href="#fit-the-data" id="toc-fit-the-data" class="nav-link" data-scroll-target="#fit-the-data">Fit the Data</a></li>
  <li><a href="#assess-feature-importance" id="toc-assess-feature-importance" class="nav-link" data-scroll-target="#assess-feature-importance">Assess Feature Importance</a></li>
  <li><a href="#assess-model-performance" id="toc-assess-model-performance" class="nav-link" data-scroll-target="#assess-model-performance">Assess Model Performance</a></li>
  <li><a href="#model-tuning" id="toc-model-tuning" class="nav-link" data-scroll-target="#model-tuning">Model Tuning</a></li>
  <li><a href="#check-metrics" id="toc-check-metrics" class="nav-link" data-scroll-target="#check-metrics">Check Metrics:</a></li>
  <li><a href="#final-model-evaluation" id="toc-final-model-evaluation" class="nav-link" data-scroll-target="#final-model-evaluation">Final Model Evaluation</a></li>
  </ul></li>
  <li><a href="#visualizing-our-results" id="toc-visualizing-our-results" class="nav-link" data-scroll-target="#visualizing-our-results">Visualizing our results</a>
  <ul class="collapse">
  <li><a href="#a-map-of-the-us" id="toc-a-map-of-the-us" class="nav-link" data-scroll-target="#a-map-of-the-us">A map of the US</a></li>
  <li><a href="#outline-of-the-us" id="toc-outline-of-the-us" class="nav-link" data-scroll-target="#outline-of-the-us">Outline of the US</a></li>
  <li><a href="#world-map" id="toc-world-map" class="nav-link" data-scroll-target="#world-map">World map:</a></li>
  <li><a href="#just-the-us" id="toc-just-the-us" class="nav-link" data-scroll-target="#just-the-us">Just the US</a></li>
  <li><a href="#just-the-us-1" id="toc-just-the-us-1" class="nav-link" data-scroll-target="#just-the-us-1">Just the US</a></li>
  <li><a href="#monitor-data" id="toc-monitor-data" class="nav-link" data-scroll-target="#monitor-data">Monitor Data</a></li>
  <li><a href="#county-lines" id="toc-county-lines" class="nav-link" data-scroll-target="#county-lines">County Lines</a></li>
  <li><a href="#the-map" id="toc-the-map" class="nav-link" data-scroll-target="#the-map">The Map</a></li>
  <li><a href="#counties" id="toc-counties" class="nav-link" data-scroll-target="#counties">Counties</a></li>
  <li><a href="#map-truth" id="toc-map-truth" class="nav-link" data-scroll-target="#map-truth">Map: Truth</a></li>
  <li><a href="#map-predictions" id="toc-map-predictions" class="nav-link" data-scroll-target="#map-predictions">Map: Predictions</a></li>
  <li><a href="#final-plot" id="toc-final-plot" class="nav-link" data-scroll-target="#final-plot">Final Plot</a>
  <ul class="collapse">
  <li><a href="#code-3" id="toc-code-3" class="nav-link" data-scroll-target="#code-3">Code</a></li>
  <li><a href="#plot-3" id="toc-plot-3" class="nav-link" data-scroll-target="#plot-3">Plot</a></li>
  </ul></li>
  <li><a href="#your-case-study" id="toc-your-case-study" class="nav-link" data-scroll-target="#your-case-study">Your Case Study</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="13-cs02-analysis-slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/lectures/00-welcome.html">Notes</a></li><li class="breadcrumb-item"><a href="../../content/lectures/13-cs02-analysis.html">13-cs02-analysis</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">13-cs02-analysis</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Professor Shannon Ellis </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            UC San Diego <br> COGS 137 - Fall 2024
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="cs02-predicting-air-pollution-analysis" class="level1" data-background-color="#92A86A">
<h1 data-background-color="#92A86A">CS02: Predicting Air Pollution (Analysis)</h1>
<section id="qa" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="qa">Q&amp;A</h2>
<blockquote class="blockquote">
<p>Q: “First, in our CS02, is our prediction US annual average air pollution concentrations based on”“value”“? Is this going to be our outcome, as it was in class?<br>
A: <code>value</code> will be our outcome. In this set of notes, we’ll discuss how to directly answer our question using machine learning.</p>
</blockquote>
<blockquote class="blockquote">
<p>Q: How do we decide whether to use main effects of interaction effects? Do we have to try both and compare r square values?<br>
A: Well, we only include an interaction term if it actually makes sense for what we’re modelling, if the interaction term’s inclusion makes logical sense - meaning it could impact the relationship between the other predictor and outcome. Without that, it doesn’t make sense to include an interaction term, as the simplest model (no interaction) is preferred overall.</p>
</blockquote>
<blockquote class="blockquote">
<p>Q: San you redefine the differences between main vs.&nbsp;interaction effects? what are the pros and cons of each?<br>
A: In a main effects model, we’re assuming the relationship between the predictor and outcome <strong>does not vary</strong> (is not impacted) by the second predictor (different y-intercepts; same slope/rate of change). In an interaction effects model we’re assuming the second predictor <em>does</em> impact the primary predictor and outcomes relationship. (different y-intercepts; different slopes). Con of interaction is that it adds an additional term into the model and is more difficult to interpret. So, you only want to go for an interaction effects model <em>if it truly does a better job capturing the underlying relationships in the data</em>.</p>
</blockquote>
<blockquote class="blockquote">
<p>Q: I wonder if we will go over logistic regressions, or k-clusters, or any other form of ML algorithms .<br>
A: We’re not going to do logistic regression this quarter, but will introduce ML algorithms in this set of notes!</p>
</blockquote>
</section>
<section id="course-announcements" class="level2">
<h2 class="anchored" data-anchor-id="course-announcements">Course Announcements</h2>
<ul>
<li><strong>Lab07</strong> due Thursday</li>
<li><strong>HW03</strong> due Friday</li>
<li><strong>CS02</strong> due Monday</li>
<li><strong>Final Project - rough draft</strong> due Monday</li>
</ul>
<p>Notes:</p>
<ul>
<li><strong>Lab06</strong> scores/feedback posted</li>
<li><strong>CS01</strong> scores/feedback posted
<ul>
<li>Feedback as issue on repo</li>
<li>If your score on CS02 is higher than CS01 that score will automatically be used for both CS01 and CS02</li>
</ul></li>
<li>Class Thursday will be time to work on CS02</li>
</ul>
</section>
<section id="progress-check-in" class="level2">
<h2 class="anchored" data-anchor-id="progress-check-in">Progress Check-in</h2>
<p><span style="background-color: #ADD8E6">❓ Where should you and your group be for CSO2 completion?</span></p>
<p>. . .</p>
<p><span style="background-color: #ADD8E6">❓ Where should you be at right now for your final project? What should you have done for rough draft on Monday?</span></p>
</section>
</section>
<section id="question" class="level1" data-background-color="#92A86A">
<h1 data-background-color="#92A86A">Question</h1>
<blockquote class="blockquote">
<p>With what accuracy can we predict US annual average air pollution concentrations?</p>
</blockquote>
</section>
<section id="analysis" class="level1" data-background-color="#92A86A">
<h1 data-background-color="#92A86A">Analysis</h1>
<section id="building-our-tidymodels-knowledge" class="level2">
<h2 class="anchored" data-anchor-id="building-our-tidymodels-knowledge">Building our <code>tidymodels</code> knowledge:</h2>
<p><img src="images/14/Updated_tidymodels_basics.png" class="img-fluid"></p>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"OCS_data/data/raw/pm25_data.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting to factors</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> pm <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(id, fips, zcta), as.factor)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-splitting" class="level2">
<h2 class="anchored" data-anchor-id="data-splitting">Data Splitting</h2>
<p align="center">
</p><p><img src="images/17/split.png" width="800"></p>
<p></p>
<p>. . .</p>
<p>Specify the split:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pm_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(<span class="at">data =</span> pm, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pm_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;584/292/876&gt;</code></pre>
</div>
</div>
<ul>
<li><code>set.seed</code> &lt;- ensures we all get the exact same random split</li>
<li>output displayed: <code>&lt;training data sample number, testing data sample number, original sample number&gt;</code></li>
</ul>
<p>More on how people decide what proportions to use for data splitting <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/sam.11583">here</a></p>
</section>
<section id="split-the-data" class="level2">
<h2 class="anchored" data-anchor-id="split-the-data">Split the Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>train_pm <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(pm_split)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>test_pm <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(pm_split)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Scroll through the output!</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(train_pm, state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 49 × 2
   state                    n
   &lt;chr&gt;                &lt;int&gt;
 1 Alabama                 13
 2 Arizona                 12
 3 Arkansas                 8
 4 California              55
 5 Colorado                10
 6 Connecticut             12
 7 Delaware                 3
 8 District Of Columbia     2
 9 Florida                 22
10 Georgia                 20
# ℹ 39 more rows</code></pre>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ What do you observe about the output?</span></p>
</section>
<section id="pre-processing-recipe-bake" class="level2">
<h2 class="anchored" data-anchor-id="pre-processing-recipe-bake">Pre-processing: <code>recipe()</code> + <code>bake()</code></h2>
<p>Need to:</p>
<ul>
<li>specify predictors vs.&nbsp;outcome</li>
<li>scale variables</li>
<li>remove redundant variables (feature engineering)</li>
</ul>
<p>. . .</p>
<p><code>recipe</code> provides a standardized format for a sequence of steps for pre-processing the data</p>
<p>. . .</p>
<p align="center">
</p><p><img src="images/17/Starting_a_recipe_recipes1.png" width="550"></p>
<p></p>
</section>
<section id="step-1-specify-variable-roles" class="level2">
<h2 class="anchored" data-anchor-id="step-1-specify-variable-roles">Step 1: Specify variable roles</h2>
<p>The simplest approach…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="ot">&lt;-</span> train_pm <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(value <span class="sc">~</span> .)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>simple_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 49</code></pre>
</div>
</div>
<p>. . .</p>
<p>…but we need to specify which column includes ID information</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="ot">&lt;-</span> train_pm <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(value <span class="sc">~</span> .) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  recipes<span class="sc">::</span><span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>simple_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   48
id variable:  1</code></pre>
</div>
</div>
<p>. . .</p>
<p>…and which are our predictors and which is our outcome</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(train_pm) <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="fu">everything</span>(), <span class="at">new_role =</span> <span class="st">"predictor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(value, <span class="at">new_role =</span> <span class="st">"outcome"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>simple_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   48
id variable:  1</code></pre>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ Can someone summarize what this code is specifying?</span></p>
<p>. . .</p>
<p>Summarizing our recipe thus far:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 4
   variable type      role        source  
   &lt;chr&gt;    &lt;list&gt;    &lt;chr&gt;       &lt;chr&gt;   
 1 id       &lt;chr [3]&gt; id variable original
 2 value    &lt;chr [2]&gt; outcome     original
 3 fips     &lt;chr [3]&gt; predictor   original
 4 lat      &lt;chr [2]&gt; predictor   original
 5 lon      &lt;chr [2]&gt; predictor   original
 6 state    &lt;chr [3]&gt; predictor   original
 7 county   &lt;chr [3]&gt; predictor   original
 8 city     &lt;chr [3]&gt; predictor   original
 9 CMAQ     &lt;chr [2]&gt; predictor   original
10 zcta     &lt;chr [3]&gt; predictor   original
# ℹ 40 more rows</code></pre>
</div>
</div>
</section>
<section id="step-2-pre-process-with-step" class="level2">
<h2 class="anchored" data-anchor-id="step-2-pre-process-with-step">Step 2: Pre-process with <code>step*()</code></h2>
<p><img src="images/17/Making_a_recipe_recipes2.png" class="img-fluid"></p>
</section>
<section id="steps" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="steps">Steps</h2>
<p><u>There are step functions for a variety of purposes:</u></p>
<ol type="1">
<li><a href="https://en.wikipedia.org/wiki/Imputation_(statistics)" target="_blank"><strong>Imputation</strong></a> – filling in missing values based on the existing data</li>
<li><a href="https://en.wikipedia.org/wiki/Data_transformation_(statistics)" target="_blank"><strong>Transformation</strong></a> – changing all values of a variable in the same way, typically to make it more normal or easier to interpret</li>
<li><a href="https://en.wikipedia.org/wiki/Discretization_of_continuous_features" target="_blank"><strong>Discretization</strong></a> – converting continuous values into discrete or nominal values - binning for example to reduce the number of possible levels (However this is generally not advisable!)</li>
<li><a href="https://en.wikipedia.org/wiki/Dummy_variable_(statistics)" target="_blank"><strong>Encoding / Creating Dummy Variables</strong></a> – creating a numeric code for categorical variables (<a href="https://medium.com/p/b5840be3c41a/responses/show" target="_blank"><strong>More on one-hot and Dummy Variables encoding</strong></a>)</li>
<li><a href="https://cran.r-project.org/web/packages/hablar/vignettes/convert.html" target="_blank"><strong>Data type conversions</strong></a> – which means changing from integer to factor or numeric to date etc.</li>
<li><a href="https://statisticsbyjim.com/regression/interaction-effects/" target="_blank"><strong>Interaction</strong></a> term addition to the model – which means that we would be modeling for predictors that would influence the capacity of each other to predict the outcome</li>
<li><a href="https://en.wikipedia.org/wiki/Normalization_(statistics)" target="_blank"><strong>Normalization</strong></a> – centering and scaling the data to a similar range of values</li>
<li><a href="https://en.wikipedia.org/wiki/Dimensionality_reduction" target="_blank"><strong>Dimensionality Reduction/ Signal Extraction</strong></a> – reducing the space of features or predictors to a smaller set of variables that capture the variation or signal in the original variables (ex. Principal Component Analysis and Independent Component Analysis)</li>
<li><strong>Filtering</strong> – filtering options for removing variables (ex. remove variables that are highly correlated to others or remove variables with very little variance and therefore likely little predictive capacity)</li>
<li><a href="https://tartarus.org/gareth/maths/Linear_Algebra/row_operations.pdf" target="_blank"><strong>Row operations</strong></a> – performing functions on the values within the rows (ex. rearranging, filtering, imputing)</li>
<li><strong>Checking functions</strong> – Gut checks to look for missing values, to look at the variable classes etc.</li>
</ol>
<p><strong>This <a href="https://tidymodels.github.io/recipes/reference/index.html" target="_blank">link</a> and this <a href="https://cran.r-project.org/web/packages/recipes/recipes.pdf" target="_blank">link</a> show the many options for recipe step functions.</strong></p>
</section>
<section id="selecting-variables" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="selecting-variables">Selecting Variables</h2>
<p>There are several ways to select what variables to apply steps to:</p>
<ol type="1">
<li>Using <code>tidyselect</code> methods: <code>contains()</code>, <code>matches()</code>, <code>starts_with()</code>, <code>ends_with()</code>, <code>everything()</code>, <code>num_range()</code><br>
</li>
<li>Using the type: <code>all_nominal()</code>, <code>all_numeric()</code> , <code>has_type()</code></li>
<li>Using the role: <code>all_predictors()</code>, <code>all_outcomes()</code>, <code>has_role()</code></li>
<li>Using the name - use the actual name of the variable/variables of interest</li>
</ol>
</section>
<section id="one-hot-encoding" class="level2">
<h2 class="anchored" data-anchor-id="one-hot-encoding">One-hot Encoding</h2>
<p>One-hot encoding categorical variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(state, county, city, zcta, <span class="at">one_hot =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   48
id variable:  1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: state, county, city, zcta</code></pre>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ Can anyone explain what one-hot encoding does?</span></p>
<p>. . .</p>
<ul>
<li><code>fips</code> includes numeric code for state and county, so it’s another way to specify county</li>
<li>so, we’ll change <code>fips</code>’ role</li>
<li>we get to decide what to call it (<code>"county id"</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   47
county id:    1
id variable:  1</code></pre>
</div>
</div>
<p>. . .</p>
<p>Removing highly correlated variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span> CMAQ, <span class="sc">-</span> aod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   48
id variable:  1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Correlation filter on: all_predictors(), -CMAQ, -aod</code></pre>
</div>
</div>
<ul>
<li>specifying to KEEP <code>CMAQ</code> and <code>aod</code></li>
</ul>
<p>. . .</p>
<p>Removing variables with non-zero variance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span> CMAQ, <span class="sc">-</span> aod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   48
id variable:  1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Sparse, unbalanced variable filter on: all_predictors(), -CMAQ, -aod</code></pre>
</div>
</div>
</section>
<section id="putting-our-recipe-together" class="level2">
<h2 class="anchored" data-anchor-id="putting-our-recipe-together">Putting our <code>recipe</code> together</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>simple_rec <span class="ot">&lt;-</span> simple_rec <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(state, county, city, zcta, <span class="at">one_hot =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span> CMAQ, <span class="sc">-</span> aod)<span class="sc">|&gt;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span> CMAQ, <span class="sc">-</span> aod)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>simple_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:      1
predictor:   47
county id:    1
id variable:  1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: state, county, city, zcta</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Correlation filter on: all_predictors(), -CMAQ, -aod</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Sparse, unbalanced variable filter on: all_predictors(), -CMAQ, -aod</code></pre>
</div>
</div>
<p>Note: order of steps matters</p>
</section>
<section id="step-3-running-the-pre-processing-prep" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="step-3-running-the-pre-processing-prep">Step 3: Running the pre-processing (<code>prep</code>)</h2>
<p>There are some important arguments to know about:</p>
<ol type="1">
<li><code>training</code> - you must supply a training data set to estimate parameters for pre-processing operations (recipe steps) - this may already be included in your recipe - as is the case for us</li>
<li><code>fresh</code> - if <code>fresh=TRUE</code>, will retrain and estimate parameters for any previous steps that were already prepped if you add more steps to the recipe (default is <code>FALSE</code>)</li>
<li><code>verbose</code> - if <code>verbose=TRUE</code>, shows the progress as the steps are evaluated and the size of the pre-processed training set (default is <code>FALSE</code>)</li>
<li><code>retain</code> - if <code>retain=TRUE</code>, then the pre-processed training set will be saved within the recipe (as template). This is good if you are likely to add more steps and do not want to rerun the <code>prep()</code> on the previous steps. However this can make the recipe size large. This is necessary if you want to actually look at the pre-processed data (default is <code>TRUE</code>)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>prepped_rec <span class="ot">&lt;-</span> <span class="fu">prep</span>(simple_rec, </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">retain =</span> <span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>oper 1 step dummy [training] 
oper 2 step corr [training] 
oper 3 step nzv [training] 
The retained training set is ~ 0.26 Mb  in memory.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prepped_rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "var_info"       "term_info"      "steps"          "template"      
 [5] "levels"         "retained"       "requirements"   "tr_info"       
 [9] "orig_lvls"      "last_term_info"</code></pre>
</div>
</div>
<p>. . .</p>
<p>This output includes a lot of information:</p>
<ol type="1">
<li>the <code>steps</code> that were run<br>
</li>
<li>the original variable info (<code>var_info</code>)<br>
</li>
<li>the updated variable info after pre-processing (<code>term_info</code>)</li>
<li>the new <code>levels</code> of the variables</li>
<li>the original levels of the variables (<code>orig_lvls</code>)</li>
<li>info about the training data set size and completeness (<code>tr_info</code>)</li>
</ol>
</section>
<section id="step-4-extract-pre-processed-training-data-using-bake" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="step-4-extract-pre-processed-training-data-using-bake">Step 4: Extract pre-processed training data using <code>bake()</code></h2>
<p><img src="images/17/training_preprocessing_recipes3.png" class="img-fluid"></p>
<p><code>bake()</code>: apply our modeling steps (in this case just pre-processing on the training data) and see what it would do the data</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>baked_train <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped_rec, <span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baked_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 584
Columns: 37
$ id                          &lt;fct&gt; 18003.0004, 55041.0007, 6065.1003, 39009.0…
$ value                       &lt;dbl&gt; 11.699065, 6.956780, 13.289744, 10.742000,…
$ fips                        &lt;fct&gt; 18003, 55041, 6065, 39009, 39061, 24510, 6…
$ lat                         &lt;dbl&gt; 41.09497, 45.56300, 33.94603, 39.44217, 39…
$ lon                         &lt;dbl&gt; -85.10182, -88.80880, -117.40063, -81.9088…
$ CMAQ                        &lt;dbl&gt; 10.383231, 3.411247, 11.404085, 7.971165, …
$ zcta_area                   &lt;dbl&gt; 16696709, 370280916, 41957182, 132383592, …
$ zcta_pop                    &lt;dbl&gt; 21306, 4141, 44001, 1115, 6566, 934, 41192…
$ imp_a500                    &lt;dbl&gt; 28.9783737, 0.0000000, 30.3901384, 0.00000…
$ imp_a15000                  &lt;dbl&gt; 13.0547959, 0.3676404, 23.7457506, 0.33079…
$ county_area                 &lt;dbl&gt; 1702419942, 2626421270, 18664696661, 13043…
$ county_pop                  &lt;dbl&gt; 355329, 9304, 2189641, 64757, 802374, 6209…
$ log_dist_to_prisec          &lt;dbl&gt; 6.621891, 8.415468, 7.419762, 6.344681, 5.…
$ log_pri_length_5000         &lt;dbl&gt; 8.517193, 8.517193, 10.150514, 8.517193, 9…
$ log_pri_length_25000        &lt;dbl&gt; 12.77378, 10.16440, 13.14450, 10.12663, 13…
$ log_prisec_length_500       &lt;dbl&gt; 6.214608, 6.214608, 6.214608, 6.214608, 7.…
$ log_prisec_length_1000      &lt;dbl&gt; 9.240294, 7.600902, 7.600902, 8.793450, 8.…
$ log_prisec_length_5000      &lt;dbl&gt; 11.485093, 9.425537, 10.155961, 10.562382,…
$ log_prisec_length_10000     &lt;dbl&gt; 12.75582, 11.44833, 11.59563, 11.69093, 12…
$ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 4.91110140, 3.86982666, 4.03184660, 0.0000…
$ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 5.399131, 3.883689, 5.459257, 0.000000, 6.…
$ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 5.816047, 3.887264, 6.884537, 3.765635, 6.…
$ popdens_county              &lt;dbl&gt; 208.719947, 3.542463, 117.314577, 49.64834…
$ popdens_zcta                &lt;dbl&gt; 1276.059851, 11.183401, 1048.711994, 8.422…
$ nohs                        &lt;dbl&gt; 4.3, 5.1, 3.7, 4.8, 2.1, 0.0, 2.5, 7.7, 0.…
$ somehs                      &lt;dbl&gt; 6.7, 10.4, 5.9, 11.5, 10.5, 0.0, 4.3, 7.5,…
$ hs                          &lt;dbl&gt; 31.7, 40.3, 17.9, 47.3, 30.0, 0.0, 17.8, 2…
$ somecollege                 &lt;dbl&gt; 27.2, 24.1, 26.3, 20.0, 27.1, 0.0, 26.1, 2…
$ associate                   &lt;dbl&gt; 8.2, 7.4, 8.3, 3.1, 8.5, 71.4, 13.2, 7.6, …
$ bachelor                    &lt;dbl&gt; 15.0, 8.6, 20.2, 9.8, 14.2, 0.0, 23.4, 17.…
$ grad                        &lt;dbl&gt; 6.8, 4.2, 17.7, 3.5, 7.6, 28.6, 12.6, 12.3…
$ pov                         &lt;dbl&gt; 13.500, 18.900, 6.700, 14.400, 12.500, 3.5…
$ hs_orless                   &lt;dbl&gt; 42.7, 55.8, 27.5, 63.6, 42.6, 0.0, 24.6, 3…
$ urc2006                     &lt;dbl&gt; 3, 6, 1, 5, 1, 1, 2, 1, 2, 6, 4, 4, 4, 4, …
$ aod                         &lt;dbl&gt; 54.11111, 31.16667, 83.12500, 33.36364, 50…
$ state_California            &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, …
$ city_Not.in.a.city          &lt;dbl&gt; 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<ul>
<li><code>new_data = NULL</code> specifies that we’re not (yet) looking at our testing data</li>
<li>We only have 36 variables (33 predictors + 2 id variables + outcome)</li>
<li>categorical variables (<code>state</code>) are gone (one-hot encoding)</li>
<li><code>state_California</code> remains - only state with nonzero variance (largest # of monitors)</li>
</ul>
</section>
<section id="step-5-extract-pre-processed-testing-data-using-bake" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="step-5-extract-pre-processed-testing-data-using-bake">Step 5: Extract pre-processed testing data using <code>bake()</code></h2>
<blockquote class="blockquote">
<p><code>bake()</code> takes a trained recipe and applies the operations to a data set to create a design matrix. For example: it applies the centering to new data sets using these means used to create the recipe. - <code>tidymodels</code> documentation</p>
</blockquote>
<p>. . .</p>
<p>Typically, you want to avoid using your testing data…but our data set is not that large and NA values in our testing dataset could cause issues later on.</p>
<p align="center">
</p><p><img src="images/17/testing_preprocessing_recipes4.png" width="550"></p>
<p></p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>baked_test_pm <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">bake</span>(prepped_rec, <span class="at">new_data =</span> test_pm)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baked_test_pm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 292
Columns: 37
$ id                          &lt;fct&gt; 1033.1002, 1055.001, 1069.0003, 1073.0023,…
$ value                       &lt;dbl&gt; 11.212174, 12.375394, 10.508850, 15.591017…
$ fips                        &lt;fct&gt; 1033, 1055, 1069, 1073, 1073, 1073, 1073, …
$ lat                         &lt;dbl&gt; 34.75878, 33.99375, 31.22636, 33.55306, 33…
$ lon                         &lt;dbl&gt; -87.65056, -85.99107, -85.39077, -86.81500…
$ CMAQ                        &lt;dbl&gt; 9.402679, 9.241744, 9.121892, 10.235612, 1…
$ zcta_area                   &lt;dbl&gt; 16716984, 154069359, 162685124, 26929603, …
$ zcta_pop                    &lt;dbl&gt; 9042, 20045, 30217, 9010, 16140, 3699, 137…
$ imp_a500                    &lt;dbl&gt; 19.17301038, 16.49307958, 19.13927336, 41.…
$ imp_a15000                  &lt;dbl&gt; 5.2472094, 5.1612102, 4.7401296, 17.452484…
$ county_area                 &lt;dbl&gt; 1534877333, 1385618994, 1501737720, 287819…
$ county_pop                  &lt;dbl&gt; 54428, 104430, 101547, 658466, 658466, 194…
$ log_dist_to_prisec          &lt;dbl&gt; 5.760131, 5.261457, 7.112373, 6.600958, 6.…
$ log_pri_length_5000         &lt;dbl&gt; 8.517193, 9.066563, 8.517193, 11.156977, 1…
$ log_pri_length_25000        &lt;dbl&gt; 10.15769, 12.01356, 10.12663, 12.98762, 12…
$ log_prisec_length_500       &lt;dbl&gt; 8.611945, 8.740680, 6.214608, 6.214608, 6.…
$ log_prisec_length_1000      &lt;dbl&gt; 9.735569, 9.627898, 7.600902, 9.075921, 8.…
$ log_prisec_length_5000      &lt;dbl&gt; 11.770407, 11.728889, 12.298627, 12.281645…
$ log_prisec_length_10000     &lt;dbl&gt; 12.840663, 12.768279, 12.994141, 13.278416…
$ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 6.69187313, 4.43719884, 0.92888890, 8.2097…
$ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 6.70127741, 4.46267932, 3.67473904, 8.6488…
$ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 7.148858, 4.678311, 3.744629, 8.858019, 8.…
$ popdens_county              &lt;dbl&gt; 35.460814, 75.367038, 67.619664, 228.77763…
$ popdens_zcta                &lt;dbl&gt; 540.8870404, 130.1037411, 185.7391706, 334…
$ nohs                        &lt;dbl&gt; 7.3, 4.3, 5.8, 7.1, 2.7, 11.1, 9.7, 3.0, 8…
$ somehs                      &lt;dbl&gt; 15.8, 13.3, 11.6, 17.1, 6.6, 11.6, 21.6, 1…
$ hs                          &lt;dbl&gt; 30.6, 27.8, 29.8, 37.2, 30.7, 46.0, 39.3, …
$ somecollege                 &lt;dbl&gt; 20.9, 29.2, 21.4, 23.5, 25.7, 17.2, 21.6, …
$ associate                   &lt;dbl&gt; 7.6, 10.1, 7.9, 7.3, 8.0, 4.1, 5.2, 6.6, 4…
$ bachelor                    &lt;dbl&gt; 12.7, 10.0, 13.7, 5.9, 17.6, 7.1, 2.2, 7.8…
$ grad                        &lt;dbl&gt; 5.1, 5.4, 9.8, 2.0, 8.7, 2.9, 0.4, 4.2, 3.…
$ pov                         &lt;dbl&gt; 19.0, 8.8, 15.6, 25.5, 7.3, 8.1, 13.3, 23.…
$ hs_orless                   &lt;dbl&gt; 53.7, 45.4, 47.2, 61.4, 40.0, 68.7, 70.6, …
$ urc2006                     &lt;dbl&gt; 4, 4, 4, 1, 1, 1, 2, 3, 3, 3, 2, 5, 4, 1, …
$ aod                         &lt;dbl&gt; 36.000000, 43.416667, 33.000000, 39.583333…
$ state_California            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ city_Not.in.a.city          &lt;dbl&gt; NA, NA, NA, 0, 1, 1, 1, NA, NA, NA, 0, NA,…</code></pre>
</div>
</div>
<p>. . .</p>
<p>Hmm….lots of NAs now in <code>city_Not.in.a.city</code></p>
<p>Likely b/c there are cities in our testing dataset that were not in our training dataset…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>traincities <span class="ot">&lt;-</span> train_pm <span class="sc">|&gt;</span> <span class="fu">distinct</span>(city)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>testcities <span class="ot">&lt;-</span> test_pm <span class="sc">|&gt;</span> <span class="fu">distinct</span>(city)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co">#get the number of cities that were different</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dplyr<span class="sc">::</span><span class="fu">setdiff</span>(traincities, testcities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 381   1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get the number of cities that overlapped</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dplyr<span class="sc">::</span><span class="fu">intersect</span>(traincities, testcities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55  1</code></pre>
</div>
</div>
</section>
<section id="aside-return-to-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="aside-return-to-wrangling">Aside: return to wrangling</h2>
<p>A quick return to wrangling…and re-splitting our data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> pm <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(city <span class="sc">==</span> <span class="st">"Not in a city"</span> <span class="sc">~</span> <span class="st">"Not in a city"</span>,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                          city <span class="sc">!=</span> <span class="st">"Not in a city"</span> <span class="sc">~</span> <span class="st">"In a city"</span>))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># same seed as before</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>pm_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(<span class="at">data =</span> pm, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>pm_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;584/292/876&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a> train_pm <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(pm_split)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a> test_pm <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(pm_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>And a recipe update…(putting it all together)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>novel_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(train_pm) <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="fu">everything</span>(), <span class="at">new_role =</span> <span class="st">"predictor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(value, <span class="at">new_role =</span> <span class="st">"outcome"</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_dummy</span>(state, county, city, zcta, <span class="at">one_hot =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_corr</span>(<span class="fu">all_numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_nzv</span>(<span class="fu">all_numeric</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>re-<code>bake()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>prepped_rec <span class="ot">&lt;-</span> <span class="fu">prep</span>(novel_rec, <span class="at">verbose =</span> <span class="cn">TRUE</span>, <span class="at">retain =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>oper 1 step dummy [training] 
oper 2 step corr [training] 
oper 3 step nzv [training] 
The retained training set is ~ 0.27 Mb  in memory.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>baked_train <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped_rec, <span class="at">new_data =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Looking at the output</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baked_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 584
Columns: 38
$ id                          &lt;fct&gt; 18003.0004, 55041.0007, 6065.1003, 39009.0…
$ value                       &lt;dbl&gt; 11.699065, 6.956780, 13.289744, 10.742000,…
$ fips                        &lt;fct&gt; 18003, 55041, 6065, 39009, 39061, 24510, 6…
$ lat                         &lt;dbl&gt; 41.09497, 45.56300, 33.94603, 39.44217, 39…
$ lon                         &lt;dbl&gt; -85.10182, -88.80880, -117.40063, -81.9088…
$ CMAQ                        &lt;dbl&gt; 10.383231, 3.411247, 11.404085, 7.971165, …
$ zcta_area                   &lt;dbl&gt; 16696709, 370280916, 41957182, 132383592, …
$ zcta_pop                    &lt;dbl&gt; 21306, 4141, 44001, 1115, 6566, 934, 41192…
$ imp_a500                    &lt;dbl&gt; 28.9783737, 0.0000000, 30.3901384, 0.00000…
$ imp_a15000                  &lt;dbl&gt; 13.0547959, 0.3676404, 23.7457506, 0.33079…
$ county_area                 &lt;dbl&gt; 1702419942, 2626421270, 18664696661, 13043…
$ county_pop                  &lt;dbl&gt; 355329, 9304, 2189641, 64757, 802374, 6209…
$ log_dist_to_prisec          &lt;dbl&gt; 6.621891, 8.415468, 7.419762, 6.344681, 5.…
$ log_pri_length_5000         &lt;dbl&gt; 8.517193, 8.517193, 10.150514, 8.517193, 9…
$ log_pri_length_25000        &lt;dbl&gt; 12.77378, 10.16440, 13.14450, 10.12663, 13…
$ log_prisec_length_500       &lt;dbl&gt; 6.214608, 6.214608, 6.214608, 6.214608, 7.…
$ log_prisec_length_1000      &lt;dbl&gt; 9.240294, 7.600902, 7.600902, 8.793450, 8.…
$ log_prisec_length_5000      &lt;dbl&gt; 11.485093, 9.425537, 10.155961, 10.562382,…
$ log_prisec_length_10000     &lt;dbl&gt; 12.75582, 11.44833, 11.59563, 11.69093, 12…
$ log_prisec_length_25000     &lt;dbl&gt; 13.98749, 13.15082, 13.44293, 13.58697, 14…
$ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 4.91110140, 3.86982666, 4.03184660, 0.0000…
$ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 5.399131, 3.883689, 5.459257, 0.000000, 6.…
$ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 5.816047, 3.887264, 6.884537, 3.765635, 6.…
$ popdens_county              &lt;dbl&gt; 208.719947, 3.542463, 117.314577, 49.64834…
$ popdens_zcta                &lt;dbl&gt; 1276.059851, 11.183401, 1048.711994, 8.422…
$ nohs                        &lt;dbl&gt; 4.3, 5.1, 3.7, 4.8, 2.1, 0.0, 2.5, 7.7, 0.…
$ somehs                      &lt;dbl&gt; 6.7, 10.4, 5.9, 11.5, 10.5, 0.0, 4.3, 7.5,…
$ hs                          &lt;dbl&gt; 31.7, 40.3, 17.9, 47.3, 30.0, 0.0, 17.8, 2…
$ somecollege                 &lt;dbl&gt; 27.2, 24.1, 26.3, 20.0, 27.1, 0.0, 26.1, 2…
$ associate                   &lt;dbl&gt; 8.2, 7.4, 8.3, 3.1, 8.5, 71.4, 13.2, 7.6, …
$ bachelor                    &lt;dbl&gt; 15.0, 8.6, 20.2, 9.8, 14.2, 0.0, 23.4, 17.…
$ grad                        &lt;dbl&gt; 6.8, 4.2, 17.7, 3.5, 7.6, 28.6, 12.6, 12.3…
$ pov                         &lt;dbl&gt; 13.500, 18.900, 6.700, 14.400, 12.500, 3.5…
$ hs_orless                   &lt;dbl&gt; 42.7, 55.8, 27.5, 63.6, 42.6, 0.0, 24.6, 3…
$ urc2006                     &lt;dbl&gt; 3, 6, 1, 5, 1, 1, 2, 1, 2, 6, 4, 4, 4, 4, …
$ aod                         &lt;dbl&gt; 54.11111, 31.16667, 83.12500, 33.36364, 50…
$ state_California            &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, …
$ city_Not.in.a.city          &lt;dbl&gt; 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<p>. . .</p>
<p>Making sure the NA issue is taken are of:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>baked_test_pm <span class="ot">&lt;-</span> <span class="fu">bake</span>(prepped_rec, <span class="at">new_data =</span> test_pm)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baked_test_pm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 292
Columns: 38
$ id                          &lt;fct&gt; 1033.1002, 1055.001, 1069.0003, 1073.0023,…
$ value                       &lt;dbl&gt; 11.212174, 12.375394, 10.508850, 15.591017…
$ fips                        &lt;fct&gt; 1033, 1055, 1069, 1073, 1073, 1073, 1073, …
$ lat                         &lt;dbl&gt; 34.75878, 33.99375, 31.22636, 33.55306, 33…
$ lon                         &lt;dbl&gt; -87.65056, -85.99107, -85.39077, -86.81500…
$ CMAQ                        &lt;dbl&gt; 9.402679, 9.241744, 9.121892, 10.235612, 1…
$ zcta_area                   &lt;dbl&gt; 16716984, 154069359, 162685124, 26929603, …
$ zcta_pop                    &lt;dbl&gt; 9042, 20045, 30217, 9010, 16140, 3699, 137…
$ imp_a500                    &lt;dbl&gt; 19.17301038, 16.49307958, 19.13927336, 41.…
$ imp_a15000                  &lt;dbl&gt; 5.2472094, 5.1612102, 4.7401296, 17.452484…
$ county_area                 &lt;dbl&gt; 1534877333, 1385618994, 1501737720, 287819…
$ county_pop                  &lt;dbl&gt; 54428, 104430, 101547, 658466, 658466, 194…
$ log_dist_to_prisec          &lt;dbl&gt; 5.760131, 5.261457, 7.112373, 6.600958, 6.…
$ log_pri_length_5000         &lt;dbl&gt; 8.517193, 9.066563, 8.517193, 11.156977, 1…
$ log_pri_length_25000        &lt;dbl&gt; 10.15769, 12.01356, 10.12663, 12.98762, 12…
$ log_prisec_length_500       &lt;dbl&gt; 8.611945, 8.740680, 6.214608, 6.214608, 6.…
$ log_prisec_length_1000      &lt;dbl&gt; 9.735569, 9.627898, 7.600902, 9.075921, 8.…
$ log_prisec_length_5000      &lt;dbl&gt; 11.770407, 11.728889, 12.298627, 12.281645…
$ log_prisec_length_10000     &lt;dbl&gt; 12.840663, 12.768279, 12.994141, 13.278416…
$ log_prisec_length_25000     &lt;dbl&gt; 13.79973, 13.70026, 13.85550, 14.45221, 13…
$ log_nei_2008_pm10_sum_10000 &lt;dbl&gt; 6.69187313, 4.43719884, 0.92888890, 8.2097…
$ log_nei_2008_pm10_sum_15000 &lt;dbl&gt; 6.70127741, 4.46267932, 3.67473904, 8.6488…
$ log_nei_2008_pm10_sum_25000 &lt;dbl&gt; 7.148858, 4.678311, 3.744629, 8.858019, 8.…
$ popdens_county              &lt;dbl&gt; 35.460814, 75.367038, 67.619664, 228.77763…
$ popdens_zcta                &lt;dbl&gt; 540.8870404, 130.1037411, 185.7391706, 334…
$ nohs                        &lt;dbl&gt; 7.3, 4.3, 5.8, 7.1, 2.7, 11.1, 9.7, 3.0, 8…
$ somehs                      &lt;dbl&gt; 15.8, 13.3, 11.6, 17.1, 6.6, 11.6, 21.6, 1…
$ hs                          &lt;dbl&gt; 30.6, 27.8, 29.8, 37.2, 30.7, 46.0, 39.3, …
$ somecollege                 &lt;dbl&gt; 20.9, 29.2, 21.4, 23.5, 25.7, 17.2, 21.6, …
$ associate                   &lt;dbl&gt; 7.6, 10.1, 7.9, 7.3, 8.0, 4.1, 5.2, 6.6, 4…
$ bachelor                    &lt;dbl&gt; 12.7, 10.0, 13.7, 5.9, 17.6, 7.1, 2.2, 7.8…
$ grad                        &lt;dbl&gt; 5.1, 5.4, 9.8, 2.0, 8.7, 2.9, 0.4, 4.2, 3.…
$ pov                         &lt;dbl&gt; 19.0, 8.8, 15.6, 25.5, 7.3, 8.1, 13.3, 23.…
$ hs_orless                   &lt;dbl&gt; 53.7, 45.4, 47.2, 61.4, 40.0, 68.7, 70.6, …
$ urc2006                     &lt;dbl&gt; 4, 4, 4, 1, 1, 1, 2, 3, 3, 3, 2, 5, 4, 1, …
$ aod                         &lt;dbl&gt; 36.000000, 43.416667, 33.000000, 39.583333…
$ state_California            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ city_Not.in.a.city          &lt;dbl&gt; 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
</section>
<section id="specifying-our-model-parsnip" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="specifying-our-model-parsnip">Specifying our model (<code>parsnip</code>)</h2>
<p>There are four things we need to define about our model:</p>
<div class="incremental">
<ol class="incremental" type="1">
<li>The <strong>type</strong> of model (using specific functions in parsnip like <code>rand_forest()</code>, <code>logistic_reg()</code> etc.)<br>
</li>
<li>The package or <strong>engine</strong> that we will use to implement the type of model selected (using the <code>set_engine()</code> function)</li>
<li>The <strong>mode</strong> of learning - classification or regression (using the <code>set_mode()</code> function)</li>
<li>Any <strong>arguments</strong> necessary for the model/package selected (using the <code>set_args()</code>function - for example the <code>mtry =</code> argument for random forest which is the number of variables to be used as options for splitting at each tree node)</li>
</ol>
</div>
</section>
<section id="step-1-specify-the-model" class="level2">
<h2 class="anchored" data-anchor-id="step-1-specify-the-model">Step 1: Specify the model</h2>
<ul>
<li>We’ll start with linear regression, but move to random forest</li>
<li>See <a href="https://www.tidymodels.org/find/parsnip/" target="_blank">here</a> for modeling options in <code>parsnip</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>lm_PM_model <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>lm_PM_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
</section>
<section id="step-2-fit-the-model" class="level2">
<h2 class="anchored" data-anchor-id="step-2-fit-the-model">Step 2: Fit the model</h2>
<ul>
<li><code>workflows</code> package allows us to keep track of both our pre-processing steps and our model specification</li>
<li>It also allows us to implement fancier optimizations in an automated way and it can also handle post-processing operations.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>PM_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>            workflows<span class="sc">::</span><span class="fu">add_recipe</span>(novel_rec) <span class="sc">|&gt;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>            workflows<span class="sc">::</span><span class="fu">add_model</span>(lm_PM_model)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>PM_wflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
3 Recipe Steps

• step_dummy()
• step_corr()
• step_nzv()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ Who can explain the difference between a recipe, baking, and a workflow?</span></p>
</section>
<section id="step-3-prepare-the-recipe-estimate-the-parameters" class="level2">
<h2 class="anchored" data-anchor-id="step-3-prepare-the-recipe-estimate-the-parameters">Step 3: Prepare the recipe (estimate the parameters)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>PM_wflow_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(PM_wflow, <span class="at">data =</span> train_pm)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>PM_wflow_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
3 Recipe Steps

• step_dummy()
• step_corr()
• step_nzv()

── Model ───────────────────────────────────────────────────────────────────────

Call:
stats::lm(formula = ..y ~ ., data = data)

Coefficients:
                (Intercept)                          lat  
                  2.936e+02                    3.261e-02  
                        lon                         CMAQ  
                  1.586e-02                    2.463e-01  
                  zcta_area                     zcta_pop  
                 -3.433e-10                    1.013e-05  
                   imp_a500                   imp_a15000  
                  5.064e-03                   -3.066e-03  
                county_area                   county_pop  
                 -2.324e-11                   -7.576e-08  
         log_dist_to_prisec          log_pri_length_5000  
                  6.214e-02                   -2.006e-01  
       log_pri_length_25000        log_prisec_length_500  
                 -5.411e-02                    2.204e-01  
     log_prisec_length_1000       log_prisec_length_5000  
                  1.154e-01                    2.374e-01  
    log_prisec_length_10000      log_prisec_length_25000  
                 -3.436e-02                    5.224e-01  
log_nei_2008_pm10_sum_10000  log_nei_2008_pm10_sum_15000  
                  1.829e-01                   -2.355e-02  
log_nei_2008_pm10_sum_25000               popdens_county  
                  2.403e-02                    2.203e-05  
               popdens_zcta                         nohs  
                 -2.132e-06                   -2.983e+00  
                     somehs                           hs  
                 -2.956e+00                   -2.962e+00  
                somecollege                    associate  
                 -2.967e+00                   -2.999e+00  
                   bachelor                         grad  
                 -2.979e+00                   -2.978e+00  
                        pov                    hs_orless  
                  1.859e-03                           NA  
                    urc2006                          aod  
                  2.577e-01                    1.535e-02  
           state_California           city_Not.in.a.city  
                  3.114e+00                   -4.250e-02  </code></pre>
</div>
</div>
</section>
<section id="step-4-assess-model-fit" class="level2">
<h2 class="anchored" data-anchor-id="step-4-assess-model-fit">Step 4: Assess model fit</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>wflowoutput <span class="ot">&lt;-</span> PM_wflow_fit <span class="sc">|&gt;</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>wflowoutput</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 5
   term         estimate std.error statistic       p.value
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 (Intercept)  2.94e+ 2  1.18e+ 2     2.49  0.0130       
 2 lat          3.26e- 2  2.28e- 2     1.43  0.153        
 3 lon          1.59e- 2  1.01e- 2     1.58  0.115        
 4 CMAQ         2.46e- 1  3.97e- 2     6.20  0.00000000108
 5 zcta_area   -3.43e-10  1.60e-10    -2.15  0.0320       
 6 zcta_pop     1.01e- 5  5.33e- 6     1.90  0.0578       
 7 imp_a500     5.06e- 3  7.42e- 3     0.683 0.495        
 8 imp_a15000  -3.07e- 3  1.16e- 2    -0.263 0.792        
 9 county_area -2.32e-11  1.97e-11    -1.18  0.238        
10 county_pop  -7.58e- 8  9.29e- 8    -0.815 0.415        
# ℹ 26 more rows</code></pre>
</div>
</div>
<ul>
<li>We have fit our model on our training data</li>
<li>We have created a model to predict values of air pollution based on the predictors that we have included</li>
</ul>
<p>. . .</p>
<p>Understanding what variables are most important in our model…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>PM_wflow_fit <span class="sc">|&gt;</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>. . .</p>
<p>A closer look at monitors in CA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>baked_train <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_California =</span> <span class="fu">as.factor</span>(state_California)) <span class="sc">|&gt;</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_California =</span> <span class="fu">recode</span>(state_California, </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Not California"</span>, </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"California"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> state_California, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> .<span class="dv">05</span>) <span class="sc">+</span> </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location of Monitor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>. . .</p>
<p>Remember: machine learning (ML) as an optimization problem that tries to minimize the distance between our predicted outcome <span class="math inline">\(\hat{Y} = f(X)\)</span> and actual outcome <span class="math inline">\(Y\)</span> using our features (or predictor variables) <span class="math inline">\(X\)</span> as input to a function <span class="math inline">\(f\)</span> that we want to estimate.</p>
<p><span class="math display">\[d(Y - \hat{Y})\]</span></p>
<p>. . .</p>
<p>Let’s pull out our predicted outcome values <span class="math inline">\(\hat{Y} = f(X)\)</span> from the models we fit (using different approaches).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>wf_fit <span class="ot">&lt;-</span> PM_wflow_fit <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>()</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>wf_fitted_values <span class="ot">&lt;-</span> </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">augment</span>(wf_fit[[<span class="st">"fit"</span>]], <span class="at">data =</span> baked_train) <span class="sc">|&gt;</span> </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(value, .fitted<span class="sc">:</span>.std.resid)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wf_fitted_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  value .fitted   .hat .sigma   .cooksd .std.resid
  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 11.7    12.2  0.0370   2.05 0.0000648     -0.243
2  6.96    9.14 0.0496   2.05 0.00179       -1.09 
3 13.3    12.6  0.0484   2.05 0.000151       0.322
4 10.7    10.4  0.0502   2.05 0.0000504      0.183
5 14.5    11.9  0.0243   2.05 0.00113        1.26 
6 12.2     9.52 0.476    2.04 0.0850         1.81 </code></pre>
</div>
</div>
</section>
<section id="visualizing-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-model-performance">Visualizing Model Performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>wf_fitted_values <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>  value, <span class="at">y =</span> .fitted)) <span class="sc">+</span> </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"actual outcome values"</span>) <span class="sc">+</span> </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"predicted outcome values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ What do you notice about/learn from these results?</span></p>
</section>
<section id="quantifying-model-performance" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="quantifying-model-performance">Quantifying Model Performance</h2>
<p><span class="math display">\[RMSE = \sqrt{\frac{\sum_{i=1}^{n}{(\hat{y_t}- y_t)}^2}{n}}\]</span></p>
<p>. . .</p>
<p>Can use the <code>yardstick</code> package using the <code>rmse</code>()` function to calculate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">metrics</span>(wf_fitted_values,</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">truth =</span> value, <span class="at">estimate =</span> .fitted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard       1.98 
2 rsq     standard       0.392
3 mae     standard       1.47 </code></pre>
</div>
</div>
<ul>
<li>RMSE isn’t too bad</li>
<li><span class="math inline">\(R^2\)</span> suggests model is only explaining 39% of the variance in the data</li>
<li>The MAE value suggests that the average difference between the value predicted and the real value was 1.47 ug/m3. The range of the values was 3-22 in the training data, so this is a relatively small amount</li>
</ul>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-Validation</h2>
<p>Resampling + Re-partitioning:</p>
<p align="center">
</p><p><img src="images/17/resampling.png" width="550"></p>
<p></p>
<p>. . .</p>
<p>Preparing the data for cross-validation:</p>
<p align="center">
</p><p><img src="images/17/vfold.png" width="550"></p>
<p></p>
<p>Note: this is called v-fold or k-fold CV</p>
</section>
<section id="implementing-in-rsample" class="level2">
<h2 class="anchored" data-anchor-id="implementing-in-rsample">Implementing in <code>rsample()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>vfold_pm <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(<span class="at">data =</span> train_pm, <span class="at">v =</span> <span class="dv">4</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>vfold_pm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  4-fold cross-validation 
# A tibble: 4 × 2
  splits            id   
  &lt;list&gt;            &lt;chr&gt;
1 &lt;split [438/146]&gt; Fold1
2 &lt;split [438/146]&gt; Fold2
3 &lt;split [438/146]&gt; Fold3
4 &lt;split [438/146]&gt; Fold4</code></pre>
</div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pull</span>(vfold_pm, splits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
&lt;Analysis/Assess/Total&gt;
&lt;438/146/584&gt;

[[2]]
&lt;Analysis/Assess/Total&gt;
&lt;438/146/584&gt;

[[3]]
&lt;Analysis/Assess/Total&gt;
&lt;438/146/584&gt;

[[4]]
&lt;Analysis/Assess/Total&gt;
&lt;438/146/584&gt;</code></pre>
</div>
</div>
<p>. . .</p>
<p>Visualizing this process:</p>
<p align="center">
</p><p><img src="images/17/cross_validation.png" width="550"></p>
<p></p>
</section>
<section id="model-assessment-on-v-folds" class="level2">
<h2 class="anchored" data-anchor-id="model-assessment-on-v-folds">Model Assessment on v-folds</h2>
<p>Where this workflow thing really shines…</p>
<div class="cell" data-wanring="false">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>resample_fit <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">fit_resamples</span>(PM_wflow, vfold_pm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Gives us a sense of the RMSE across the four folds:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tune<span class="sc">::</span><span class="fu">show_best</span>(resample_fit, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard    2.12     4  0.0444 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
</section>
<section id="a-different-model" class="level1" data-background-color="#92A86A">
<h1 data-background-color="#92A86A">A different model?</h1>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<p>Fitting a different model…is based on a decision tree:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://miro.medium.com/max/1000/1*LMoJmXCsQlciGTEyoSN39g.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="source" class="level5">
<h5 class="anchored" data-anchor-id="source"><a href="https://towardsdatascience.com/understanding-random-forest-58381e0602d2" target="_blank">[source]</a></h5>
</section>
</section>
<section id="but-not-just-one-tree" class="level2">
<h2 class="anchored" data-anchor-id="but-not-just-one-tree">But not just one tree…</h2>
<p>But…in the case of <a href="https://towardsdatascience.com/decision-tree-ensembles-bagging-and-boosting-266a8ba60fd9" target="_blank">random forest</a>:</p>
<div class="incremental">
<ul class="incremental">
<li>multiple decision trees are created (hence: forest),</li>
<li>each tree is built using a random subset of the training data (with replacement) (hence: random)</li>
<li>helps to keep the algorithm from overfitting the data</li>
<li>The mean of the predictions from each of the trees is used in the final output.</li>
</ul>
</div>
</section>
<section id="visualizing-a-rf" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-a-rf">Visualizing a RF</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://miro.medium.com/max/1400/0*f_qQPFpdofWGLQqc.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="updating-our-recipe" class="level2">
<h2 class="anchored" data-anchor-id="updating-our-recipe">Updating our <code>recipe()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>RF_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(train_pm) <span class="sc">|&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="fu">everything</span>(), <span class="at">new_role =</span> <span class="st">"predictor"</span>)<span class="sc">|&gt;</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(value, <span class="at">new_role =</span> <span class="st">"outcome"</span>)<span class="sc">|&gt;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(id, <span class="at">new_role =</span> <span class="st">"id variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update_role</span>(<span class="st">"fips"</span>, <span class="at">new_role =</span> <span class="st">"county id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_novel</span>(<span class="st">"state"</span>) <span class="sc">|&gt;</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_string2factor</span>(<span class="st">"state"</span>, <span class="st">"county"</span>, <span class="st">"city"</span>) <span class="sc">|&gt;</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_rm</span>(<span class="st">"county"</span>) <span class="sc">|&gt;</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_rm</span>(<span class="st">"zcta"</span>) <span class="sc">|&gt;</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_corr</span>(<span class="fu">all_numeric</span>())<span class="sc">|&gt;</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_nzv</span>(<span class="fu">all_numeric</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>can use our categorical data as is (no dummy coding)</li>
<li><code>step_novel()</code>necessary here for the <code>state</code> variable to get all cross validation folds to work, (b/c there will be different levels included in each fold test and training sets. The new levels for some of the test sets would otherwise result in an error.; “step_novel creates a specification of a recipe step that will assign a previously unseen factor level to a new value.”</li>
</ul>
</section>
<section id="model-specification" class="level2">
<h2 class="anchored" data-anchor-id="model-specification">Model Specification</h2>
<p>Model parameters:</p>
<ol type="1">
<li><code>mtry</code> - The number of predictor variables (or features) that will be randomly sampled at each split when creating the tree models. The default number for regression analyses is the number of predictors divided by 3.</li>
<li><code>min_n</code> - The minimum number of data points in a node that are required for the node to be split further.</li>
<li><code>trees</code> - the number of trees in the ensemble</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("randomForest")</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>RF_PM_model <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="dv">10</span>, <span class="at">min_n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"randomForest"</span>) <span class="sc">|&gt;</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>RF_PM_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Model Specification (regression)

Main Arguments:
  mtry = 10
  min_n = 3

Computational engine: randomForest </code></pre>
</div>
</div>
</section>
<section id="workflow" class="level2">
<h2 class="anchored" data-anchor-id="workflow">Workflow</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>RF_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(RF_rec) <span class="sc">|&gt;</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(RF_PM_model)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>RF_wflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
6 Recipe Steps

• step_novel()
• step_string2factor()
• step_rm()
• step_rm()
• step_corr()
• step_nzv()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (regression)

Main Arguments:
  mtry = 10
  min_n = 3

Computational engine: randomForest </code></pre>
</div>
</div>
</section>
<section id="fit-the-data" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-data">Fit the Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>RF_wflow_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(RF_wflow, <span class="at">data =</span> train_pm)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>RF_wflow_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
6 Recipe Steps

• step_novel()
• step_string2factor()
• step_rm()
• step_rm()
• step_corr()
• step_nzv()

── Model ───────────────────────────────────────────────────────────────────────

Call:
 randomForest(x = maybe_data_frame(x), y = y, mtry = min_cols(~10,      x), nodesize = min_rows(~3, x)) 
               Type of random forest: regression
                     Number of trees: 500
No. of variables tried at each split: 10

          Mean of squared residuals: 2.633639
                    % Var explained: 59.29</code></pre>
</div>
</div>
</section>
<section id="assess-feature-importance" class="level2">
<h2 class="anchored" data-anchor-id="assess-feature-importance">Assess Feature Importance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>RF_wflow_fit <span class="sc">|&gt;</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ What’s your interpretation of these results?</span></p>
</section>
<section id="assess-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="assess-model-performance">Assess Model Performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>resample_RF_fit <span class="ot">&lt;-</span> tune<span class="sc">::</span><span class="fu">fit_resamples</span>(RF_wflow, vfold_pm)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(resample_RF_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   1.67      4  0.101  Preprocessor1_Model1
2 rsq     standard   0.591     4  0.0514 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>. . .</p>
<p>For comparison:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(resample_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   2.12      4  0.0444 Preprocessor1_Model1
2 rsq     standard   0.307     4  0.0263 Preprocessor1_Model1</code></pre>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ Thoughts on which model better achieves our goal?</span></p>
</section>
<section id="model-tuning" class="level2">
<h2 class="anchored" data-anchor-id="model-tuning">Model Tuning</h2>
<p><a href="https://machinelearningmastery.com/difference-between-a-parameter-and-a-hyperparameter/">Hyperparameters</a> are often things that we need to specify about a model. Instead of arbitrarily specifying this, we can try to determine the best option for model performance by a process called tuning.</p>
<p>. . .</p>
<p>Rather than specifying values, we can use <code>tune()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>tune_RF_model <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"randomForest"</span>) <span class="sc">|&gt;</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>tune_RF_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Model Specification (regression)

Main Arguments:
  mtry = tune()
  min_n = tune()

Computational engine: randomForest </code></pre>
</div>
</div>
<p>. . .</p>
<p>Create Workflow:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>RF_tune_wflow <span class="ot">&lt;-</span> workflows<span class="sc">::</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_recipe</span>(RF_rec) <span class="sc">|&gt;</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  workflows<span class="sc">::</span><span class="fu">add_model</span>(tune_RF_model)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>RF_tune_wflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
6 Recipe Steps

• step_novel()
• step_string2factor()
• step_rm()
• step_rm()
• step_corr()
• step_nzv()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (regression)

Main Arguments:
  mtry = tune()
  min_n = tune()

Computational engine: randomForest </code></pre>
</div>
</div>
<p>Detect how many cores you have access to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>n_cores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<p>. . .</p>
<p>This code will take some time to run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("doParallel")</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> n_cores)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>tune_RF_results <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(<span class="at">object =</span> RF_tune_wflow, <span class="at">resamples =</span> vfold_pm, <span class="at">grid =</span> <span class="dv">20</span>)</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>tune_RF_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Tuning results
# 4-fold cross-validation 
# A tibble: 4 × 4
  splits            id    .metrics          .notes          
  &lt;list&gt;            &lt;chr&gt; &lt;list&gt;            &lt;list&gt;          
1 &lt;split [438/146]&gt; Fold1 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
2 &lt;split [438/146]&gt; Fold2 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;
3 &lt;split [438/146]&gt; Fold3 &lt;tibble [40 × 6]&gt; &lt;tibble [1 × 3]&gt;
4 &lt;split [438/146]&gt; Fold4 &lt;tibble [40 × 6]&gt; &lt;tibble [0 × 3]&gt;

There were issues with some computations:

  - Warning(s) x1: 36 columns were requested but there were 35 predictors in the dat...

Run `show_notes(.Last.tune.result)` for more information.</code></pre>
</div>
</div>
</section>
<section id="check-metrics" class="level2">
<h2 class="anchored" data-anchor-id="check-metrics">Check Metrics:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>tune_RF_results <span class="sc">|&gt;</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 8
    mtry min_n .metric .estimator  mean     n std_err .config              
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1    12    33 rmse    standard   1.72      4  0.0866 Preprocessor1_Model01
 2    12    33 rsq     standard   0.562     4  0.0466 Preprocessor1_Model01
 3    27    35 rmse    standard   1.69      4  0.102  Preprocessor1_Model02
 4    27    35 rsq     standard   0.563     4  0.0511 Preprocessor1_Model02
 5    22    40 rmse    standard   1.71      4  0.106  Preprocessor1_Model03
 6    22    40 rsq     standard   0.556     4  0.0543 Preprocessor1_Model03
 7     1    27 rmse    standard   2.03      4  0.0501 Preprocessor1_Model04
 8     1    27 rsq     standard   0.440     4  0.0245 Preprocessor1_Model04
 9     6    32 rmse    standard   1.77      4  0.0756 Preprocessor1_Model05
10     6    32 rsq     standard   0.552     4  0.0435 Preprocessor1_Model05
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(tune_RF_results, <span class="at">metric =</span> <span class="st">"rmse"</span>, <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
   mtry min_n .metric .estimator  mean     n std_err .config              
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
1    32    11 rmse    standard    1.65     4   0.113 Preprocessor1_Model10</code></pre>
</div>
</div>
</section>
<section id="final-model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="final-model-evaluation">Final Model Evaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>tuned_RF_values <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tune_RF_results, <span class="st">"rmse"</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>tuned_RF_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
   mtry min_n .config              
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
1    32    11 Preprocessor1_Model10</code></pre>
</div>
</div>
<p>. . .</p>
<p>The testing data!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify best combination from tune in workflow</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>RF_tuned_wflow <span class="ot">&lt;-</span> RF_tune_wflow <span class="sc">|&gt;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(tuned_RF_values)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model with those parameters on train AND test</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>overallfit <span class="ot">&lt;-</span> RF_wflow <span class="sc">|&gt;</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  tune<span class="sc">::</span><span class="fu">last_fit</span>(pm_split)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(overallfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard       1.72  Preprocessor1_Model1
2 rsq     standard       0.608 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>Results are similar to what we saw in training (RMSE: 1.65)</p>
<p>. . .</p>
<p>Getting the predictions for the test data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>test_predictions <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(overallfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualizing-our-results" class="level1" data-background-color="#92A86A">
<h1 data-background-color="#92A86A">Visualizing our results</h1>
<section id="a-map-of-the-us" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="a-map-of-the-us">A map of the US</h2>
<p>Packages needed:</p>
<ol type="1">
<li><code>sf</code> - the simple features package helps to convert geographical coordinates into <code>geometry</code> variables which are useful for making 2D plots</li>
<li><code>maps</code> - this package contains geographical outlines and plotting functions to create plots with maps</li>
<li><code>rnaturalearth</code>- this allows for easy interaction with map data from <a href="http://www.naturalearthdata.com/">Natural Earth</a> which is a public domain map dataset</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="outline-of-the-us" class="level2">
<h2 class="anchored" data-anchor-id="outline-of-the-us">Outline of the US</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(world)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 241
Columns: 64
$ scalerank  &lt;int&gt; 3, 1, 1, 1, 1, 3, 3, 1, 1, 1, 3, 1, 5, 3, 1, 1, 1, 1, 1, 1,…
$ featurecla &lt;chr&gt; "Admin-0 country", "Admin-0 country", "Admin-0 country", "A…
$ labelrank  &lt;dbl&gt; 5, 3, 3, 6, 6, 6, 6, 4, 2, 6, 4, 4, 5, 6, 6, 2, 4, 5, 6, 2,…
$ sovereignt &lt;chr&gt; "Netherlands", "Afghanistan", "Angola", "United Kingdom", "…
$ sov_a3     &lt;chr&gt; "NL1", "AFG", "AGO", "GB1", "ALB", "FI1", "AND", "ARE", "AR…
$ adm0_dif   &lt;dbl&gt; 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0,…
$ level      &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
$ type       &lt;chr&gt; "Country", "Sovereign country", "Sovereign country", "Depen…
$ admin      &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ adm0_a3    &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALD", "AND", "ARE", "AR…
$ geou_dif   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ geounit    &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ gu_a3      &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALD", "AND", "ARE", "AR…
$ su_dif     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ subunit    &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ su_a3      &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALD", "AND", "ARE", "AR…
$ brk_diff   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ name       &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ name_long  &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ brk_a3     &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALD", "AND", "ARE", "AR…
$ brk_name   &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ brk_group  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ abbrev     &lt;chr&gt; "Aruba", "Afg.", "Ang.", "Ang.", "Alb.", "Aland", "And.", "…
$ postal     &lt;chr&gt; "AW", "AF", "AO", "AI", "AL", "AI", "AND", "AE", "AR", "ARM…
$ formal_en  &lt;chr&gt; "Aruba", "Islamic State of Afghanistan", "People's Republic…
$ formal_fr  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ note_adm0  &lt;chr&gt; "Neth.", NA, NA, "U.K.", NA, "Fin.", NA, NA, NA, NA, "U.S.A…
$ note_brk   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "Multiple claim…
$ name_sort  &lt;chr&gt; "Aruba", "Afghanistan", "Angola", "Anguilla", "Albania", "A…
$ name_alt   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ mapcolor7  &lt;dbl&gt; 4, 5, 3, 6, 1, 4, 1, 2, 3, 3, 4, 4, 1, 7, 2, 1, 3, 1, 2, 3,…
$ mapcolor8  &lt;dbl&gt; 2, 6, 2, 6, 4, 1, 4, 1, 1, 1, 5, 5, 2, 5, 2, 2, 1, 6, 2, 2,…
$ mapcolor9  &lt;dbl&gt; 2, 8, 6, 6, 1, 4, 1, 3, 3, 2, 1, 1, 2, 9, 5, 2, 3, 5, 5, 1,…
$ mapcolor13 &lt;dbl&gt; 9, 7, 1, 3, 6, 6, 8, 3, 13, 10, 1, NA, 7, 11, 5, 7, 4, 8, 8…
$ pop_est    &lt;dbl&gt; 103065, 28400000, 12799293, 14436, 3639453, 27153, 83888, 4…
$ gdp_md_est &lt;dbl&gt; 2258.0, 22270.0, 110300.0, 108.9, 21810.0, 1563.0, 3660.0, …
$ pop_year   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ lastcensus &lt;dbl&gt; 2010, 1979, 1970, NA, 2001, NA, 1989, 2010, 2010, 2001, 201…
$ gdp_year   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ economy    &lt;chr&gt; "6. Developing region", "7. Least developed region", "7. Le…
$ income_grp &lt;chr&gt; "2. High income: nonOECD", "5. Low income", "3. Upper middl…
$ wikipedia  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ fips_10    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ iso_a2     &lt;chr&gt; "AW", "AF", "AO", "AI", "AL", "AX", "AD", "AE", "AR", "AM",…
$ iso_a3     &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALA", "AND", "ARE", "AR…
$ iso_n3     &lt;chr&gt; "533", "004", "024", "660", "008", "248", "020", "784", "03…
$ un_a3      &lt;chr&gt; "533", "004", "024", "660", "008", "248", "020", "784", "03…
$ wb_a2      &lt;chr&gt; "AW", "AF", "AO", NA, "AL", NA, "AD", "AE", "AR", "AM", "AS…
$ wb_a3      &lt;chr&gt; "ABW", "AFG", "AGO", NA, "ALB", NA, "ADO", "ARE", "ARG", "A…
$ woe_id     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ adm0_a3_is &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALA", "AND", "ARE", "AR…
$ adm0_a3_us &lt;chr&gt; "ABW", "AFG", "AGO", "AIA", "ALB", "ALD", "AND", "ARE", "AR…
$ adm0_a3_un &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ adm0_a3_wb &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ continent  &lt;chr&gt; "North America", "Asia", "Africa", "North America", "Europe…
$ region_un  &lt;chr&gt; "Americas", "Asia", "Africa", "Americas", "Europe", "Europe…
$ subregion  &lt;chr&gt; "Caribbean", "Southern Asia", "Middle Africa", "Caribbean",…
$ region_wb  &lt;chr&gt; "Latin America &amp; Caribbean", "South Asia", "Sub-Saharan Afr…
$ name_len   &lt;dbl&gt; 5, 11, 6, 8, 7, 5, 7, 20, 9, 7, 14, 10, 23, 22, 17, 9, 7, 1…
$ long_len   &lt;dbl&gt; 5, 11, 6, 8, 7, 13, 7, 20, 9, 7, 14, 10, 27, 35, 19, 9, 7, …
$ abbrev_len &lt;dbl&gt; 5, 4, 4, 4, 4, 5, 4, 6, 4, 4, 9, 4, 7, 10, 6, 4, 5, 4, 4, 5…
$ tiny       &lt;dbl&gt; 4, NA, NA, NA, NA, 5, 5, NA, NA, NA, 3, NA, NA, 2, 4, NA, N…
$ homepart   &lt;dbl&gt; NA, 1, 1, NA, 1, NA, 1, 1, 1, 1, NA, 1, NA, NA, 1, 1, 1, 1,…
$ geometry   &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-69.89912 1..., MULTIPOLYGON (…</code></pre>
</div>
</div>
</section>
<section id="world-map" class="level2">
<h2 class="anchored" data-anchor-id="world-map">World map:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="just-the-us" class="level2">
<h2 class="anchored" data-anchor-id="just-the-us">Just the US</h2>
<p>According to this <a href="https://en.wikipedia.org/wiki/List_of_extreme_points_of_the_United_States#Westernmost" target="_blank">link</a>, these are the latitude and longitude bounds of the continental US:</p>
<ul>
<li>top = 49.3457868 # north lat</li>
<li>left = -124.7844079 # west long</li>
<li>right = -66.9513812 # east long</li>
<li>bottom = 24.7433195 # south lat</li>
</ul>
</section>
<section id="just-the-us-1" class="level2">
<h2 class="anchored" data-anchor-id="just-the-us-1">Just the US</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">66</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">24.5</span>, <span class="dv">50</span>), </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">expand =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="monitor-data" class="level2">
<h2 class="anchored" data-anchor-id="monitor-data">Monitor Data</h2>
<p>Adding in our monitors…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">66</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">24.5</span>, <span class="dv">50</span>), </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">expand =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> pm, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat), <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="county-lines" class="level2">
<h2 class="anchored" data-anchor-id="county-lines">County Lines</h2>
<p>Adding in county lines</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">"county"</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">fill =</span> <span class="cn">TRUE</span>))</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>counties</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3076 features and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -124.6813 ymin: 25.12993 xmax: -67.00742 ymax: 49.38323
Geodetic CRS:  +proj=longlat +ellps=clrk66 +no_defs +type=crs
First 10 features:
                               ID                           geom
alabama,autauga   alabama,autauga MULTIPOLYGON (((-86.50517 3...
alabama,baldwin   alabama,baldwin MULTIPOLYGON (((-87.93757 3...
alabama,barbour   alabama,barbour MULTIPOLYGON (((-85.42801 3...
alabama,bibb         alabama,bibb MULTIPOLYGON (((-87.02083 3...
alabama,blount     alabama,blount MULTIPOLYGON (((-86.9578 33...
alabama,bullock   alabama,bullock MULTIPOLYGON (((-85.66866 3...
alabama,butler     alabama,butler MULTIPOLYGON (((-86.8604 31...
alabama,calhoun   alabama,calhoun MULTIPOLYGON (((-85.74313 3...
alabama,chambers alabama,chambers MULTIPOLYGON (((-85.59416 3...
alabama,cherokee alabama,cherokee MULTIPOLYGON (((-85.46812 3...</code></pre>
</div>
</div>
</section>
<section id="the-map" class="level2">
<h2 class="anchored" data-anchor-id="the-map">The Map</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Plot</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>monitors <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="fu">gray</span>(.<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">66</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">24.5</span>, <span class="dv">50</span>), </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> pm, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat), <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Monitor Locations"</span>) <span class="sc">+</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="counties" class="level2">
<h2 class="anchored" data-anchor-id="counties">Counties</h2>
<p>Wrangle counties:</p>
<ul>
<li>separate county and state into separate columns</li>
<li>make title case</li>
<li>combine with PM data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> counties <span class="sc">|&gt;</span> </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(ID, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"county"</span>), <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">|&gt;</span> </span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">county =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(county))</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(counties, pm, <span class="at">by =</span> <span class="st">"county"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="map-truth" class="level2">
<h2 class="anchored" data-anchor-id="map-truth">Map: Truth</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Plot</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>truth <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>,<span class="sc">-</span><span class="dv">66</span>),</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">24.5</span>, <span class="dv">50</span>),</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">topo.colors</span>(<span class="dv">7</span>),</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">na.value =</span> <span class="st">"transparent"</span>,</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">23.5</span>),</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"PM ug/m3"</span>) <span class="sc">+</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"True PM 2.5 levels"</span>) <span class="sc">+</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="map-predictions" class="level2">
<h2 class="anchored" data-anchor-id="map-predictions">Map: Predictions</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Plot</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit data</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>RF_final_train_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(RF_tuned_wflow, <span class="at">data =</span> train_pm)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>RF_final_test_fit <span class="ot">&lt;-</span> parsnip<span class="sc">::</span><span class="fu">fit</span>(RF_tuned_wflow, <span class="at">data =</span> test_pm)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get predictions on training data</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>values_pred_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(RF_final_train_fit, train_pm) <span class="sc">|&gt;</span> </span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(train_pm <span class="sc">|&gt;</span> <span class="fu">select</span>(value, fips, county, id)) </span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get predictions on testing data</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>values_pred_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(RF_final_test_fit, test_pm) <span class="sc">|&gt;</span> </span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_pm <span class="sc">|&gt;</span> <span class="fu">select</span>(value, fips, county, id)) </span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>values_pred_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 292 × 5
   .pred value fips  county     id       
   &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;      &lt;fct&gt;    
 1  11.6  11.2 1033  Colbert    1033.1002
 2  11.9  12.4 1055  Etowah     1055.001 
 3  11.1  10.5 1069  Houston    1069.0003
 4  13.9  15.6 1073  Jefferson  1073.0023
 5  12.0  12.4 1073  Jefferson  1073.1005
 6  11.3  11.1 1073  Jefferson  1073.1009
 7  11.5  11.8 1073  Jefferson  1073.5003
 8  11.0  10.0 1097  Mobile     1097.0003
 9  11.9  12.0 1101  Montgomery 1101.0007
10  12.9  13.2 1113  Russell    1113.0001
# ℹ 282 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>all_pred <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(values_pred_test, values_pred_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(counties, all_pred, <span class="at">by =</span> <span class="st">"county"</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>,<span class="sc">-</span><span class="dv">66</span>),</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">24.5</span>, <span class="dv">50</span>),</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">fill =</span> .pred)) <span class="sc">+</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">topo.colors</span>(<span class="dv">7</span>),</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">na.value =</span> <span class="st">"transparent"</span>,</span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),</span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">23.5</span>),</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"PM ug/m3"</span>) <span class="sc">+</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted PM 2.5 levels"</span>) <span class="sc">+</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="final-plot" class="level2">
<h2 class="anchored" data-anchor-id="final-plot">Final Plot</h2>
<p>:::panel-tabset</p>
<section id="code-3" class="level3">
<h3 class="anchored" data-anchor-id="code-3">Code</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> (truth<span class="sc">/</span>pred) <span class="sc">+</span> </span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Machine Learning Methods Allow for Prediction of Air Pollution"</span>, <span class="at">subtitle =</span> <span class="st">"A random forest model predicts true monitored levels of fine particulate matter (PM 2.5) air pollution based on</span><span class="sc">\n</span><span class="st">data about population density and other predictors reasonably well, thus suggesting that we can use similar methods to predict levels</span><span class="sc">\n</span><span class="st">of pollution in places with poor monitoring"</span>,</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-3" class="level3">
<h3 class="anchored" data-anchor-id="plot-3">Plot</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-cs02-analysis_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p><span style="background-color: #ADD8E6">❓ What do you learn from these results?</span></p>
</section>
</section>
<section id="your-case-study" class="level2">
<h2 class="anchored" data-anchor-id="your-case-study">Your Case Study</h2>
<div class="incremental">
<ul class="incremental">
<li>Can you copy + paste code directly from here to answer the question? Yes.</li>
<li>Do you have to present linear regression model <em>and</em> random forest? No</li>
<li>Should you present anything from the 12-regression notes? Probably not. (This is why HW03 and lab07 focus on regression)</li>
<li>Could you try an additional model as your extension? Yes!</li>
<li>Does that model have to be “better”? No! But, consider the story!</li>
<li>Could you try to identify the simplest, accurate model as an extension? Yes.</li>
</ul>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cogs137-fa24\.github\.io\/cogs137-fa24\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/lectures/12-regression.html" class="pagination-link" aria-label="12-regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">12-regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/lectures/14-cs02-inclass.html" class="pagination-link" aria-label="14-cs02-inclass">
        <span class="nav-page-text">14-cs02-inclass</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../LICENSE.html">
<p>License</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with 🤍, inspiration from Mine Çetinkaya-Rundel, and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>