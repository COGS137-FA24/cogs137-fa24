{
  "hash": "a69dc6939ae3f9d0a9ce8f6e3de9840a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"16-cs02-eda\"\nauthor: \"Professor Shannon Ellis\"\ndate: \"2023-11-28\"\n\nformat:\n  html: \n    output-file: 16-cs02-eda.html\n    embed-resources: true\n  revealjs:\n    output-file: 16-cs02-eda-slides.html\n    slide-number: true\n    chalkboard: false \n    preview-links: auto\n    logo: images/cogs137-logo-hex.png\n    css: slides.css\n    footer: <https://cogs137.github.io/website/>\n    scrollable: true\n    embed-resources: true\n    execute:\n      echo: true\n      eval: true\n---\n\n::: {.cell}\n\n:::\n\n\n# CS02: Predicting Air Pollution (EDA) {background-color=\"#92A86A\"}\n\n## Q&A {.smaller}\n\n> Q: I'm a bit unclear about the direction of case studies. Do just try to visualize data differently to find out the best biomarkers or do we use other methods like modeling to do so? \\\n> A: A little bit of both. If you can rule out a matrix/compound during EDA by looking at visualizations, do that. But, once you have a set of compounds that you want to include for analysis, then you would turn to sensitivity/specificity/ROC curves to help you decide. Modelling is also an option.\n\n> Q: I saw in the dataset, in some variables I think it's the log values  ( so I assumed it's already normalized?). Why is it better to use the log data and not the raw values? \\\n> A: Great question! We'll get to this a bit today!\n\n> Q: If the monitors are not localized at the granularity of zip code level, how do we assess the accuracy of our predictions? Seems like we can't know the correct result. \\\n> A: We'll get to this in the next set of notes!\n\n## Course Announcements\n\n- **CS01** due Thursday (group work survey due Friday)\n- **Lab07** due Friday\n- **CS02** due next Friday\n- **Final Project** due Tues of Finals week (report + presentation)\n\n. . .\n\nVote:\n\n- *Option 1*: Continue as planned cs01 (12.5) + cs02 (12.5) + final project (18)\n- *Option 2*: \n  - CS01 due Thursday (17)\n  - Complete *either* CS02 w/ external data req'd for extension OR Final Project (**with final project group**; due Finals week) (26) \n\n. . .\n\nCS02 and Final Project repos + emails went out yesterday\n\n- please look for your repo/make sure you have access!\n- please get in communication with your groups if you're not already in communication\n\n\n# Question {background-color=\"#92A86A\"}\n\n> Can we predict US annual average air pollution concentrations at the granularity of zip code regional levels using predictors such as data about population density, urbanization, road density, as well as, satellite pollution data and chemical modeling data?\n\n\n# EDA {background-color=\"#92A86A\"}\n\nGetting to \"know\" the data\n\n## The Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm <- readr::read_csv(here::here(\"OCS_data\", \"data\",\"raw\", \"pm25_data.csv\"))\n```\n:::\n\n\n\n## `skimr` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskimr::skim(pm)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |pm   |\n|Number of rows           |876  |\n|Number of columns        |50   |\n|_______________________  |     |\n|Column type frequency:   |     |\n|character                |3    |\n|numeric                  |47   |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|state         |         0|             1|   4|  20|     0|       49|          0|\n|county        |         0|             1|   3|  20|     0|      471|          0|\n|city          |         0|             1|   4|  48|     0|      607|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable               | n_missing| complete_rate|          mean|           sd|          p0|           p25|           p50|           p75|          p100|hist  |\n|:---------------------------|---------:|-------------:|-------------:|------------:|-----------:|-------------:|-------------:|-------------:|-------------:|:-----|\n|id                          |         0|             1|      26987.96| 1.578761e+04|     1003.00|      13089.15|      26132.00|      39118.00|  5.603910e+04|▇▇▆▇▆ |\n|value                       |         0|             1|         10.81| 2.580000e+00|        3.02|          9.27|         11.15|         12.37|  2.316000e+01|▂▆▇▁▁ |\n|fips                        |         0|             1|      26987.89| 1.578763e+04|     1003.00|      13089.00|      26132.00|      39118.00|  5.603900e+04|▇▇▆▇▆ |\n|lat                         |         0|             1|         38.48| 4.620000e+00|       25.47|         35.03|         39.30|         41.66|  4.840000e+01|▁▃▅▇▂ |\n|lon                         |         0|             1|        -91.74| 1.496000e+01|     -124.18|        -99.16|        -87.47|        -80.69| -6.804000e+01|▃▂▃▇▃ |\n|CMAQ                        |         0|             1|          8.41| 2.970000e+00|        1.63|          6.53|          8.62|         10.24|  2.313000e+01|▃▇▃▁▁ |\n|zcta                        |         0|             1|      50890.29| 2.778447e+04|     1022.00|      28788.25|      48172.00|      74371.00|  9.920200e+04|▅▇▇▅▇ |\n|zcta_area                   |         0|             1|  183173481.91| 5.425989e+08|    15459.00|   14204601.75|   37653560.50|  160041508.25|  8.164821e+09|▇▁▁▁▁ |\n|zcta_pop                    |         0|             1|      24227.58| 1.777216e+04|        0.00|       9797.00|      22014.00|      35004.75|  9.539700e+04|▇▇▃▁▁ |\n|imp_a500                    |         0|             1|         24.72| 1.934000e+01|        0.00|          3.70|         25.12|         40.22|  6.961000e+01|▇▅▆▃▂ |\n|imp_a1000                   |         0|             1|         24.26| 1.802000e+01|        0.00|          5.32|         24.53|         38.59|  6.750000e+01|▇▅▆▃▁ |\n|imp_a5000                   |         0|             1|         19.93| 1.472000e+01|        0.05|          6.79|         19.07|         30.11|  7.460000e+01|▇▆▃▁▁ |\n|imp_a10000                  |         0|             1|         15.82| 1.381000e+01|        0.09|          4.54|         12.36|         24.17|  7.209000e+01|▇▃▂▁▁ |\n|imp_a15000                  |         0|             1|         13.43| 1.312000e+01|        0.11|          3.24|          9.67|         20.55|  7.110000e+01|▇▃▁▁▁ |\n|county_area                 |         0|             1| 3768701992.12| 6.212830e+09| 33703512.00| 1116536297.50| 1690826566.50| 2878192209.00|  5.194723e+10|▇▁▁▁▁ |\n|county_pop                  |         0|             1|     687298.44| 1.293489e+06|      783.00|     100948.00|     280730.50|     743159.00|  9.818605e+06|▇▁▁▁▁ |\n|log_dist_to_prisec          |         0|             1|          6.19| 1.410000e+00|       -1.46|          5.43|          6.36|          7.15|  1.045000e+01|▁▁▃▇▁ |\n|log_pri_length_5000         |         0|             1|          9.82| 1.080000e+00|        8.52|          8.52|         10.05|         10.73|  1.205000e+01|▇▂▆▅▂ |\n|log_pri_length_10000        |         0|             1|         10.92| 1.130000e+00|        9.21|          9.80|         11.17|         11.83|  1.302000e+01|▇▂▇▇▃ |\n|log_pri_length_15000        |         0|             1|         11.50| 1.150000e+00|        9.62|         10.87|         11.72|         12.40|  1.359000e+01|▆▂▇▇▃ |\n|log_pri_length_25000        |         0|             1|         12.24| 1.100000e+00|       10.13|         11.69|         12.46|         13.05|  1.436000e+01|▅▃▇▇▃ |\n|log_prisec_length_500       |         0|             1|          6.99| 9.500000e-01|        6.21|          6.21|          6.21|          7.82|  9.400000e+00|▇▁▂▂▁ |\n|log_prisec_length_1000      |         0|             1|          8.56| 7.900000e-01|        7.60|          7.60|          8.66|          9.20|  1.047000e+01|▇▅▆▃▁ |\n|log_prisec_length_5000      |         0|             1|         11.28| 7.800000e-01|        8.52|         10.91|         11.42|         11.83|  1.278000e+01|▁▁▃▇▃ |\n|log_prisec_length_10000     |         0|             1|         12.41| 7.300000e-01|        9.21|         11.99|         12.53|         12.94|  1.385000e+01|▁▁▃▇▅ |\n|log_prisec_length_15000     |         0|             1|         13.03| 7.200000e-01|        9.62|         12.59|         13.13|         13.57|  1.441000e+01|▁▁▃▇▅ |\n|log_prisec_length_25000     |         0|             1|         13.82| 7.000000e-01|       10.13|         13.38|         13.92|         14.35|  1.523000e+01|▁▁▃▇▆ |\n|log_nei_2008_pm25_sum_10000 |         0|             1|          3.97| 2.350000e+00|        0.00|          2.15|          4.29|          5.69|  9.120000e+00|▆▅▇▆▂ |\n|log_nei_2008_pm25_sum_15000 |         0|             1|          4.72| 2.250000e+00|        0.00|          3.47|          5.00|          6.35|  9.420000e+00|▃▃▇▇▂ |\n|log_nei_2008_pm25_sum_25000 |         0|             1|          5.67| 2.110000e+00|        0.00|          4.66|          5.91|          7.28|  9.650000e+00|▂▂▇▇▃ |\n|log_nei_2008_pm10_sum_10000 |         0|             1|          4.35| 2.320000e+00|        0.00|          2.69|          4.62|          6.07|  9.340000e+00|▅▅▇▇▂ |\n|log_nei_2008_pm10_sum_15000 |         0|             1|          5.10| 2.180000e+00|        0.00|          3.87|          5.39|          6.72|  9.710000e+00|▂▃▇▇▂ |\n|log_nei_2008_pm10_sum_25000 |         0|             1|          6.07| 2.010000e+00|        0.00|          5.10|          6.37|          7.52|  9.880000e+00|▁▂▆▇▃ |\n|popdens_county              |         0|             1|        551.76| 1.711510e+03|        0.26|         40.77|        156.67|        510.81|  2.682191e+04|▇▁▁▁▁ |\n|popdens_zcta                |         0|             1|       1279.66| 2.757490e+03|        0.00|        101.15|        610.35|       1382.52|  3.041884e+04|▇▁▁▁▁ |\n|nohs                        |         0|             1|          6.99| 7.210000e+00|        0.00|          2.70|          5.10|          8.80|  1.000000e+02|▇▁▁▁▁ |\n|somehs                      |         0|             1|         10.17| 6.200000e+00|        0.00|          5.90|          9.40|         13.90|  7.220000e+01|▇▂▁▁▁ |\n|hs                          |         0|             1|         30.32| 1.140000e+01|        0.00|         23.80|         30.75|         36.10|  1.000000e+02|▂▇▂▁▁ |\n|somecollege                 |         0|             1|         21.58| 8.600000e+00|        0.00|         17.50|         21.30|         24.70|  1.000000e+02|▆▇▁▁▁ |\n|associate                   |         0|             1|          7.13| 4.010000e+00|        0.00|          4.90|          7.10|          8.80|  7.140000e+01|▇▁▁▁▁ |\n|bachelor                    |         0|             1|         14.90| 9.710000e+00|        0.00|          8.80|         12.95|         19.22|  1.000000e+02|▇▂▁▁▁ |\n|grad                        |         0|             1|          8.91| 8.650000e+00|        0.00|          3.90|          6.70|         11.00|  1.000000e+02|▇▁▁▁▁ |\n|pov                         |         0|             1|         14.95| 1.133000e+01|        0.00|          6.50|         12.10|         21.22|  6.590000e+01|▇▅▂▁▁ |\n|hs_orless                   |         0|             1|         47.48| 1.675000e+01|        0.00|         37.92|         48.65|         59.10|  1.000000e+02|▁▃▇▃▁ |\n|urc2013                     |         0|             1|          2.92| 1.520000e+00|        1.00|          2.00|          3.00|          4.00|  6.000000e+00|▇▅▃▂▁ |\n|urc2006                     |         0|             1|          2.97| 1.520000e+00|        1.00|          2.00|          3.00|          4.00|  6.000000e+00|▇▅▃▂▁ |\n|aod                         |         0|             1|         43.70| 1.956000e+01|        5.00|         31.66|         40.17|         49.67|  1.430000e+02|▃▇▁▁▁ |\n\n\n:::\n:::\n\n\n\n## Why 49 \"states\"?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm %>% \n  distinct(state) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 49 × 1\n   state               \n   <chr>               \n 1 Alabama             \n 2 Arizona             \n 3 Arkansas            \n 4 California          \n 5 Colorado            \n 6 Connecticut         \n 7 Delaware            \n 8 District Of Columbia\n 9 Florida             \n10 Georgia             \n# ℹ 39 more rows\n```\n\n\n:::\n:::\n\n\n- DC is included\n- Alaska and Hawaii are not\n\n## Number of monitors per city?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm %>% filter(city == \"San Diego\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 50\n     id value  fips   lat   lon state      county    city   CMAQ  zcta zcta_area\n  <dbl> <dbl> <dbl> <dbl> <dbl> <chr>      <chr>     <chr> <dbl> <dbl>     <dbl>\n1 6073.  11.3  6073  32.8 -117. California San Diego San …  9.68 92123  21148247\n2 6073.  13.7  6073  32.7 -117. California San Diego San …  9.68 92113  13647793\n# ℹ 39 more variables: zcta_pop <dbl>, imp_a500 <dbl>, imp_a1000 <dbl>,\n#   imp_a5000 <dbl>, imp_a10000 <dbl>, imp_a15000 <dbl>, county_area <dbl>,\n#   county_pop <dbl>, log_dist_to_prisec <dbl>, log_pri_length_5000 <dbl>,\n#   log_pri_length_10000 <dbl>, log_pri_length_15000 <dbl>,\n#   log_pri_length_25000 <dbl>, log_prisec_length_500 <dbl>,\n#   log_prisec_length_1000 <dbl>, log_prisec_length_5000 <dbl>,\n#   log_prisec_length_10000 <dbl>, log_prisec_length_15000 <dbl>, …\n```\n\n\n:::\n:::\n\n\n. . . \n\n\n::: {.cell}\n\n```{.r .cell-code}\npm %>% filter(city == \"Baltimore\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 50\n      id value  fips   lat   lon state    county     city   CMAQ  zcta zcta_area\n   <dbl> <dbl> <dbl> <dbl> <dbl> <chr>    <chr>      <chr> <dbl> <dbl>     <dbl>\n1 24510.  12.2 24510  39.3 -76.6 Maryland Baltimore… Balt…  10.9 21251    461424\n2 24510.  12.5 24510  39.3 -76.7 Maryland Baltimore… Balt…  10.9 21215  17645223\n3 24510.  12.8 24510  39.3 -76.5 Maryland Baltimore… Balt…  10.9 21224  24539976\n4 24510.  14.3 24510  39.2 -76.6 Maryland Baltimore… Balt…  10.9 21226  25718732\n5 24510.  13.3 24510  39.3 -76.6 Maryland Baltimore… Balt…  10.9 21202   4111039\n# ℹ 39 more variables: zcta_pop <dbl>, imp_a500 <dbl>, imp_a1000 <dbl>,\n#   imp_a5000 <dbl>, imp_a10000 <dbl>, imp_a15000 <dbl>, county_area <dbl>,\n#   county_pop <dbl>, log_dist_to_prisec <dbl>, log_pri_length_5000 <dbl>,\n#   log_pri_length_10000 <dbl>, log_pri_length_15000 <dbl>,\n#   log_pri_length_25000 <dbl>, log_prisec_length_500 <dbl>,\n#   log_prisec_length_1000 <dbl>, log_prisec_length_5000 <dbl>,\n#   log_prisec_length_10000 <dbl>, log_prisec_length_15000 <dbl>, …\n```\n\n\n:::\n:::\n\n\n. . .\n\nSan Diego has 2, while Baltimore has 5, despite having very similar population densities (`popdens_county`)...and San Diego having a much larger population (`county_pop`) and land area (`county_area`).\n\n## Feature Correlation\n\nWhy do we care if variables in our dataset are correlated?\n\n- we don’t want to include redundant variables\n- can add unnecessary noise to our algorithm causing a reduction in prediction accuracy\n- can cause our algorithm to be slower\n- can also make it difficult to interpret what variables are actually predictive\n\n. . . \n\nTaking a look at our numeric variables...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPM_cor <- cor(pm %>% dplyr::select_if(is.numeric))\ncorrplot::corrplot(PM_cor, tl.cex = 0.5)\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-6-1.png){width=2100}\n:::\n:::\n\n\n- deep blue | strongly, positively correlated\n- deep red | strongly, negatively correlated\n\n. . .\n\nIf we don't care about direction, but only strength...*and* using [hierarchical clustering](https://en.wikipedia.org/wiki/Hierarchical_clustering):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot::corrplot(abs(PM_cor), order = \"hclust\", tl.cex = 0.5, cl.lim = c(0, 1))\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-7-1.png){width=2100}\n:::\n:::\n\n\n. . .\n\nObservations:\n\n- development variables (`imp`), road density (`pri`), and the emission (`nei`) variables all seem to be correlated with their group\n- none of the predictors are correlated with `value` (our outcome)\n\n## Development (`imp`)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# we used GGally in a previous set of notes\n# will need to install if you haven't yet\nselect(pm, contains(\"imp\")) %>%\n  GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-8-1.png){width=2100}\n:::\n:::\n\n\n## Emmissoins (`nei`)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nselect(pm, contains(\"nei\")) %>%\n  GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-9-1.png){width=2100}\n:::\n:::\n\n\n. . .\n\n## Road Density (`pri`)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nselect(pm, contains(\"pri\")) %>%\n  GGally::ggcorr(hjust = .85, size = 3,\n       layout.exp=2, label = TRUE)\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-10-1.png){width=2100}\n:::\n:::\n\n\nWarning: colors are reversed from above. If included in final report, you'd want consistency.\n\n## Are the categories correlated with one another?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm %>%\nselect(log_nei_2008_pm25_sum_10000, popdens_county, \n       log_pri_length_10000, imp_a10000, county_pop) %>%\n  GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-11-1.png){width=2100}\n:::\n:::\n\n\n. . .\n\nReminder:\n\n- **log_nei_2008_pm25_sum_10000** | Tons of emissions from major sources data base (annual data) sum of all sources within a circle with a radius of 10000 meters of distance around the monitor (Natural log)    \n- **popdens_county** | Population density (number of people per kilometer squared area of the county)\n- **log_pri_length_10000** | Count of primary road length in meters in a circle with a radius of 10000 meters around the monitor (Natural log) <br> -- Highways only  \n- **imp_a10000** | Impervious surface measure <br> --  Within a circle with a radius of 10000 meters around the monitor   \n- **county_pop** | Population of the county of the monitor  \n\n## Log-transforming right-skewed data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm %>%\n  mutate(log_popdens_county=log(popdens_county),\n         log_pop_county = log(county_pop)) %>%\n  select(log_nei_2008_pm25_sum_10000, log_popdens_county, \n       log_pri_length_10000, imp_a10000, log_pop_county) %>%\n  GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-12-1.png){width=2100}\n:::\n:::\n\n\n## Your Turn\n\n[💪 Try to learn at least three things about the data that we haven't yet discussed now on your own.]{style=\"background-color: #ADD8E6\"}\n\n::: aside\nPut a <font color=\"#32cb31\">green</font> sticky on the front of your computer when you're done. Put a <font color=\"#ff65a3\">pink</font> if you want help/have a question.\n:::\n\nOutcome variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(pm$value)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  3.024   9.268  11.153  10.808  12.369  23.161 \n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(pm, aes(value)) + geom_histogram()\n```\n\n::: {.cell-output-display}\n![](16-cs02-eda_files/figure-html/unnamed-chunk-13-1.png){width=2100}\n:::\n:::\n\n\nWhat do we know about the monitors that have very high values?\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm |> \n  filter(value > 20) |>\n  select(state) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 1\n  state     \n  <chr>     \n1 California\n2 California\n3 California\n4 California\n5 California\n6 California\n```\n\n\n:::\n:::\n",
    "supporting": [
      "16-cs02-eda_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}